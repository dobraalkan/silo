-- liquibase formatted sql

-- changeset dobra:1703194766143-1
CREATE TABLE "access_log" ("id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "user_id" VARCHAR(128) NOT NULL, "state" VARCHAR(255) NOT NULL, "params" VARCHAR(1024), "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(), CONSTRAINT "access_log_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "access_log" IS 'logs user page and section views';
COMMENT ON COLUMN "access_log"."user_id" IS 'identifier of the user accessing the page or section';
COMMENT ON COLUMN "access_log"."state" IS 'identifier of the page  plus optionally a section identifier (format: state|section)';
COMMENT ON COLUMN "access_log"."params" IS 'additional params provided to page/section';

-- changeset dobra:1703194766143-2
CREATE TABLE "application" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255), "description" VARCHAR(4000), "asset_code" VARCHAR(255), "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "updated_at" TIMESTAMP WITHOUT TIME ZONE NOT NULL, "organisational_unit_id" BIGINT NOT NULL, "kind" VARCHAR(128) DEFAULT 'IN_HOUSE' NOT NULL, "lifecycle_phase" VARCHAR(128) DEFAULT 'PRODUCTION' NOT NULL, "parent_asset_code" VARCHAR(255), "overall_rating" CHAR(1) DEFAULT 'Z' NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "business_criticality" VARCHAR(128) DEFAULT 'UNKNOWN' NOT NULL, "is_removed" BOOLEAN DEFAULT FALSE NOT NULL, "entity_lifecycle_status" VARCHAR(64) DEFAULT 'ACTIVE' NOT NULL, "planned_retirement_date" TIMESTAMP WITHOUT TIME ZONE, "actual_retirement_date" TIMESTAMP WITHOUT TIME ZONE, "commission_date" TIMESTAMP WITHOUT TIME ZONE, CONSTRAINT "application_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "application" IS 'represents an application (with an entity_kind of ''APPLICATION'')';
COMMENT ON COLUMN "application"."name" IS 'name of this application (aliases can be added in the entity_alias table)';
COMMENT ON COLUMN "application"."description" IS 'longer description to provide more information about this application.  Markdown is supported';
COMMENT ON COLUMN "application"."asset_code" IS 'external identifier representing this application';
COMMENT ON COLUMN "application"."organisational_unit_id" IS 'reference to the owning org unit';
COMMENT ON COLUMN "application"."kind" IS 'broad category of this application (e.g. IN_HOUSE, EXTERNALLY_HOSTED, THIRD_PARTY, EUC, etc)';
COMMENT ON COLUMN "application"."lifecycle_phase" IS 'the current application lifecycle state of this application (one of: CONCEPTUAL, DEVELOPMENT, PRODUCTION, RETIRED)';
COMMENT ON COLUMN "application"."parent_asset_code" IS 'asset code of any parent application';
COMMENT ON COLUMN "application"."overall_rating" IS 'investment rating scheme (one of: R, A, G, Z / which equates to Disinvest, Maintain, Invest, Unknown)';
COMMENT ON COLUMN "application"."provenance" IS 'origination of this application record.  Will be ''waltz'' if entered via the UI';
COMMENT ON COLUMN "application"."business_criticality" IS 'business criticality of this application (one of: LOW, MEDIUM, HIGH, VERY_HIGH, NONE, UNKNOWN)';
COMMENT ON COLUMN "application"."is_removed" IS 'should this record logically be treated as if it has been physically deleted';
COMMENT ON COLUMN "application"."entity_lifecycle_status" IS 'the lifecycle state of this entity record, slightly different from is_removed as does not imply the record is ''gone''  (one of: ACTIVE, PENDING, REMOVED)';
COMMENT ON COLUMN "application"."planned_retirement_date" IS 'date when this application is (or was) planning to retire';
COMMENT ON COLUMN "application"."actual_retirement_date" IS 'date when this application actually retired from production, null if not planned';
COMMENT ON COLUMN "application"."commission_date" IS 'when was this application commissioned, null if unknown';

-- changeset dobra:1703194766143-3
CREATE TABLE "bookmark" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "title" VARCHAR(255), "description" VARCHAR(4000), "kind" VARCHAR(255), "url" VARCHAR(500), "parent_kind" VARCHAR(255), "parent_id" BIGINT, "created_at" TIMESTAMP WITHOUT TIME ZONE NOT NULL, "updated_at" TIMESTAMP WITHOUT TIME ZONE NOT NULL, "is_primary" BOOLEAN DEFAULT FALSE NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "is_required" BOOLEAN DEFAULT FALSE NOT NULL, "is_restricted" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "bookmark_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-4
CREATE TABLE "change_log" ("id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "parent_kind" VARCHAR(128) NOT NULL, "parent_id" BIGINT NOT NULL, "message" VARCHAR(4000) NOT NULL, "user_id" VARCHAR(128) NOT NULL, "severity" VARCHAR(32) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "child_kind" VARCHAR(64), "operation" VARCHAR(64) DEFAULT 'UNKNOWN' NOT NULL, "child_id" BIGINT, CONSTRAINT "change_log_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "change_log" IS 'tracks all the data changes made within waltz';
COMMENT ON COLUMN "change_log"."id" IS 'unique identifier for this change log record within waltz';
COMMENT ON COLUMN "change_log"."parent_kind" IS 'the kind of entity this change log belongs to';
COMMENT ON COLUMN "change_log"."parent_id" IS 'the identifier of the entity this change log belongs to';
COMMENT ON COLUMN "change_log"."message" IS 'a description of the change that has been made';
COMMENT ON COLUMN "change_log"."user_id" IS 'the user responsible for making the change';
COMMENT ON COLUMN "change_log"."severity" IS 'the severity of the change log (one of: INFORMATION, WARNING, ERROR)';
COMMENT ON COLUMN "change_log"."created_at" IS 'the datetime this entry was created';
COMMENT ON COLUMN "change_log"."child_kind" IS 'the kind of entity this change relates to (e.g. LOGICAL_FLOW)';
COMMENT ON COLUMN "change_log"."operation" IS 'what sort of change was made (one of: ADD, ATTEST, REMOVE, UPDATE, UNKNOWN)';
COMMENT ON COLUMN "change_log"."child_id" IS 'optional id of the child reference associated to this change log entry';

-- changeset dobra:1703194766143-5
CREATE TABLE "organisational_unit" ("id" BIGINT NOT NULL, "name" VARCHAR(255), "description" VARCHAR(4000), "parent_id" BIGINT, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE NOT NULL, "external_id" VARCHAR(200), "created_by" VARCHAR(255) DEFAULT 'waltz' NOT NULL, "last_updated_by" VARCHAR(255) DEFAULT 'waltz' NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, CONSTRAINT "organisational_unit_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-6
CREATE TABLE "person_hierarchy" ("manager_id" VARCHAR(128) NOT NULL, "employee_id" VARCHAR(128) NOT NULL, "level" INTEGER DEFAULT 99 NOT NULL, CONSTRAINT "reportee_pkey" PRIMARY KEY ("manager_id", "employee_id"));

-- changeset dobra:1703194766143-7
CREATE TABLE "server_information" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "hostname" VARCHAR(255) NOT NULL, "operating_system" VARCHAR(128) DEFAULT 'UNKNOWN' NOT NULL, "location" VARCHAR(128) NOT NULL, "operating_system_version" VARCHAR(128) NOT NULL, "country" VARCHAR(128) NOT NULL, "is_virtual" BOOLEAN, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "os_end_of_life_date" date, "hw_end_of_life_date" date, "lifecycle_status" VARCHAR(64) DEFAULT 'UNKNOWN' NOT NULL, "external_id" VARCHAR(200), CONSTRAINT "server_information_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-8
CREATE TABLE "end_user_application" ("id" BIGINT NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "kind" VARCHAR(128) DEFAULT 'MS_EXCEL' NOT NULL, "lifecycle_phase" VARCHAR(128) DEFAULT 'PRODUCTION' NOT NULL, "risk_rating" VARCHAR(128) DEFAULT 'MEDIUM' NOT NULL, "organisational_unit_id" BIGINT NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "external_id" VARCHAR(200), "is_promoted" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "end_user_application_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-9
CREATE TABLE "static_panel" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "group" VARCHAR(128) NOT NULL, "title" VARCHAR(255), "icon" VARCHAR(64) DEFAULT 'info', "priority" INTEGER NOT NULL, "width" INTEGER DEFAULT 12 NOT NULL, "encoding" VARCHAR(64) DEFAULT 'HTML' NOT NULL, "content" TEXT NOT NULL, CONSTRAINT "static_panel_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-10
CREATE TABLE "application_group" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "kind" VARCHAR(64) DEFAULT 'PUBLIC' NOT NULL, "description" TEXT, "external_id" VARCHAR(200), "is_removed" BOOLEAN DEFAULT FALSE NOT NULL, "is_favourite_group" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "application_group_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "application_group" IS 'represents an ad-hoc collection of applications';
COMMENT ON COLUMN "application_group"."name" IS 'display name for the group';
COMMENT ON COLUMN "application_group"."kind" IS 'the type of group (one of: PUBLIC, PRIVATE).  Note, private groups can still be seen, they are merely unlisted in the UI';
COMMENT ON COLUMN "application_group"."description" IS 'longer description of the group, supports markdown';
COMMENT ON COLUMN "application_group"."external_id" IS 'external identifier, typically used when creating/syncing groups via external jobs';
COMMENT ON COLUMN "application_group"."is_removed" IS 'flag indicating if the group has been deleted';
COMMENT ON COLUMN "application_group"."is_favourite_group" IS 'a favourite group is assigned to each user to allow them to quickly bookmark apps and populate the change calendar on the homepage';

-- changeset dobra:1703194766143-11
CREATE TABLE "application_group_member" ("group_id" BIGINT NOT NULL, "user_id" VARCHAR(128) NOT NULL, "role" VARCHAR(64) DEFAULT 'VIEWER' NOT NULL, CONSTRAINT "application_group_member_pkey" PRIMARY KEY ("group_id", "user_id"));
COMMENT ON TABLE "application_group_member" IS 'users granted viewer or ownership rights to app groups';
COMMENT ON COLUMN "application_group_member"."group_id" IS 'reference to the group this member belongs to';
COMMENT ON COLUMN "application_group_member"."user_id" IS 'reference to the user id of the group member';
COMMENT ON COLUMN "application_group_member"."role" IS 'the role of the user in the group (one of: VIEWER, OWNER)';

-- changeset dobra:1703194766143-12
CREATE TABLE "logical_flow" ("source_entity_kind" VARCHAR(128) NOT NULL, "source_entity_id" BIGINT NOT NULL, "target_entity_kind" VARCHAR(128) NOT NULL, "target_entity_id" BIGINT NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "last_attested_at" TIMESTAMP WITHOUT TIME ZONE, "last_attested_by" VARCHAR(255), "entity_lifecycle_status" VARCHAR(64) DEFAULT 'ACTIVE' NOT NULL, "is_removed" BOOLEAN DEFAULT FALSE NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "created_by" VARCHAR(255) NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "logical_flow_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-13
CREATE TABLE "involvement" ("entity_kind" VARCHAR(128) NOT NULL, "entity_id" BIGINT NOT NULL, "employee_id" VARCHAR(128) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "kind_id" BIGINT NOT NULL, "is_readonly" BOOLEAN DEFAULT TRUE NOT NULL);
COMMENT ON TABLE "involvement" IS 'defines a specific instance of an involvement kind between a person and an entity (e.g. ''User X'' is ''IT Owner'' for ''APPLICATION/32'')';
COMMENT ON COLUMN "involvement"."entity_kind" IS 'the kind of entity the person is involved with';
COMMENT ON COLUMN "involvement"."entity_id" IS 'the identifier of the entity the person is involved with';
COMMENT ON COLUMN "involvement"."employee_id" IS 'reference to the person involved with the entity';
COMMENT ON COLUMN "involvement"."provenance" IS 'where did this involvement record originate, will be ''waltz'' if provided via the UI';
COMMENT ON COLUMN "involvement"."kind_id" IS 'the type of involvement between the person and the entity (e.g. ''IT Owner'')';
COMMENT ON COLUMN "involvement"."is_readonly" IS 'can this involvement be edited/removed by users (e.g. set to true if externally mastered)';

-- changeset dobra:1703194766143-14
CREATE TABLE "settings" ("name" VARCHAR(128) NOT NULL, "value" VARCHAR(4000), "restricted" BOOLEAN DEFAULT FALSE NOT NULL, "description" VARCHAR(4000), CONSTRAINT "settings_pkey" PRIMARY KEY ("name"));
COMMENT ON TABLE "settings" IS 'contains configuration data which controls the operation of Waltz.';
COMMENT ON COLUMN "settings"."name" IS 'the key name of the setting, often uses dotted notation.  Strongly recommended to put client specific settings under their own namespace (i.e. mycorp.somesetting)';
COMMENT ON COLUMN "settings"."value" IS 'the value of the setting, if the setting is a boolean it should be entered as lowercase';
COMMENT ON COLUMN "settings"."restricted" IS 'restricted settings are internal to Waltz and not available via API/external calls';
COMMENT ON COLUMN "settings"."description" IS 'optional comment to describe this setting';

-- changeset dobra:1703194766143-15
CREATE TABLE "software_package" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "vendor" VARCHAR(255), "name" VARCHAR(255) NOT NULL, "notable" BOOLEAN DEFAULT FALSE, "description" VARCHAR(4000), "external_id" VARCHAR(200), "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "created_by" VARCHAR(255) DEFAULT 'admin' NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "group" VARCHAR(255), CONSTRAINT "software_package_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-16
CREATE TABLE "entity_relationship" ("kind_a" VARCHAR(128) NOT NULL, "id_a" BIGINT NOT NULL, "kind_b" VARCHAR(128) NOT NULL, "id_b" BIGINT NOT NULL, "relationship" VARCHAR(128) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "description" VARCHAR(4000), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) DEFAULT 'admin' NOT NULL, "id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, CONSTRAINT "entity_relationship_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-17
CREATE TABLE "source_data_rating" ("source_name" VARCHAR(128) NOT NULL, "entity_kind" VARCHAR(128) NOT NULL, "authoritativeness" CHAR(1) DEFAULT 'Z' NOT NULL, "accuracy" CHAR(1) DEFAULT 'Z' NOT NULL, "completeness" CHAR(1) DEFAULT 'Z' NOT NULL, "last_import" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(), CONSTRAINT "source_data_rating_pkey" PRIMARY KEY ("source_name", "entity_kind"));

-- changeset dobra:1703194766143-18
CREATE TABLE "change_initiative" ("id" BIGINT NOT NULL, "parent_id" BIGINT, "external_id" VARCHAR(128), "name" VARCHAR(255) NOT NULL, "kind" VARCHAR(64) DEFAULT 'PROGRAMME' NOT NULL, "lifecycle_phase" VARCHAR(64) DEFAULT 'DEVELOPMENT' NOT NULL, "description" VARCHAR(4000), "last_update" date, "start_date" date NOT NULL, "end_date" date NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "organisational_unit_id" BIGINT DEFAULT 0 NOT NULL, CONSTRAINT "change_initiative_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "change_initiative" IS 'represents an change initiative (with an entity_kind of ''CHANGE_INITIATIVE'')';
COMMENT ON COLUMN "change_initiative"."id" IS 'unique identifier for this change initiative within waltz';
COMMENT ON COLUMN "change_initiative"."parent_id" IS 'the id of the parent change initiative';
COMMENT ON COLUMN "change_initiative"."external_id" IS 'external identifier for this change initiative';
COMMENT ON COLUMN "change_initiative"."name" IS 'name of this change initiative';
COMMENT ON COLUMN "change_initiative"."kind" IS 'the type of change initiative this is (one of: PROJECT, PROGRAMME, INITIATIVE)';
COMMENT ON COLUMN "change_initiative"."lifecycle_phase" IS 'the current lifecycle phase of this change initiative (one of: CONCEPTUAL, DEVELOPMENT, PRODUCTION, RETIRED)';
COMMENT ON COLUMN "change_initiative"."description" IS 'longer description to provide more information about this change initiative.  Markdown is supported';
COMMENT ON COLUMN "change_initiative"."last_update" IS 'the date information in this change initiative record was last updated';
COMMENT ON COLUMN "change_initiative"."start_date" IS 'the start date of this change initiative';
COMMENT ON COLUMN "change_initiative"."end_date" IS 'the end date of this change initiative';
COMMENT ON COLUMN "change_initiative"."provenance" IS 'origination of this change initiative record';
COMMENT ON COLUMN "change_initiative"."organisational_unit_id" IS 'reference to the owning organisational unit of this change initiative';

-- changeset dobra:1703194766143-19
CREATE TABLE "entity_statistic_definition" ("name" VARCHAR(128) NOT NULL, "description" VARCHAR(4000), "type" VARCHAR(128) NOT NULL, "category" VARCHAR(128) NOT NULL, "active" BOOLEAN NOT NULL, "renderer" VARCHAR(128) NOT NULL, "historic_renderer" VARCHAR(128) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "parent_id" BIGINT, "id" BIGINT NOT NULL, "entity_visibility" BOOLEAN DEFAULT TRUE NOT NULL, "rollup_visibility" BOOLEAN DEFAULT TRUE NOT NULL, "rollup_kind" VARCHAR(64) DEFAULT 'COUNT_BY_ENTITY' NOT NULL, "external_id" VARCHAR(200), CONSTRAINT "entity_statistic_defn_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-20
CREATE TABLE "entity_statistic_value" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "statistic_id" BIGINT NOT NULL, "entity_kind" VARCHAR(128) NOT NULL, "entity_id" BIGINT NOT NULL, "value" VARCHAR(128), "outcome" VARCHAR(128) NOT NULL, "state" VARCHAR(128) NOT NULL, "reason" VARCHAR(4000), "created_at" TIMESTAMP WITHOUT TIME ZONE NOT NULL, "current" BOOLEAN NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, CONSTRAINT "entity_statistic_value_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-21
CREATE TABLE "entity_alias" ("id" BIGINT NOT NULL, "alias" VARCHAR(255) NOT NULL, "kind" VARCHAR(128) DEFAULT 'APPLICATION' NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL);

-- changeset dobra:1703194766143-22
CREATE TABLE "data_type_usage" ("entity_kind" VARCHAR(128) NOT NULL, "entity_id" BIGINT NOT NULL, "usage_kind" VARCHAR(128) NOT NULL, "description" VARCHAR(2048) DEFAULT '' NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "is_selected" BOOLEAN, "data_type_id" BIGINT NOT NULL);

-- changeset dobra:1703194766143-23
CREATE TABLE "entity_hierarchy" ("kind" VARCHAR(128) NOT NULL, "id" BIGINT NOT NULL, "ancestor_id" BIGINT, "level" INTEGER NOT NULL, "descendant_level" INTEGER DEFAULT 0);
COMMENT ON TABLE "entity_hierarchy" IS 'a bridge (or closure) table which stores information for quick hierarchy traversals';
COMMENT ON COLUMN "entity_hierarchy"."kind" IS 'type of entity this record represents (ORG_UNIT, MEASURABLE, etc)';
COMMENT ON COLUMN "entity_hierarchy"."id" IS 'the id of the descendant (lower) entity in the hierarchy';
COMMENT ON COLUMN "entity_hierarchy"."ancestor_id" IS 'the id of the ancestor (higher) entity in the hierarchy';
COMMENT ON COLUMN "entity_hierarchy"."level" IS 'the depth of the ancestor';
COMMENT ON COLUMN "entity_hierarchy"."descendant_level" IS 'the depth of the descendant';

-- changeset dobra:1703194766143-24
CREATE TABLE "data_type" ("code" VARCHAR(128) NOT NULL, "name" VARCHAR(256) NOT NULL, "description" VARCHAR(4000), "id" BIGINT NOT NULL, "parent_id" BIGINT, "concrete" BOOLEAN DEFAULT TRUE NOT NULL, "unknown" BOOLEAN DEFAULT FALSE NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "deprecated" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "data_type_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-25
CREATE TABLE "logical_flow_decorator" ("logical_flow_id" BIGINT NOT NULL, "decorator_entity_kind" VARCHAR(128) NOT NULL, "decorator_entity_id" BIGINT NOT NULL, "rating" VARCHAR(32) DEFAULT 'NO_OPINION' NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, "flow_classification_rule_id" BIGINT, CONSTRAINT "logical_flow_decorator_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-26
CREATE TABLE "physical_flow" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "specification_id" BIGINT NOT NULL, "basis_offset" INTEGER NOT NULL, "frequency" VARCHAR(64) NOT NULL, "transport" VARCHAR(64) NOT NULL, "description" VARCHAR(4000) NOT NULL, "provenance" VARCHAR(64) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "logical_flow_id" BIGINT NOT NULL, "specification_definition_id" BIGINT, "is_removed" BOOLEAN DEFAULT FALSE NOT NULL, "last_attested_at" TIMESTAMP WITHOUT TIME ZONE, "last_attested_by" VARCHAR(255), "criticality" VARCHAR(64) DEFAULT 'MEDIUM' NOT NULL, "external_id" VARCHAR(200), "entity_lifecycle_status" VARCHAR(64) DEFAULT 'ACTIVE' NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "created_by" VARCHAR(255) NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, "name" VARCHAR(255), CONSTRAINT "physical_data_flow_pkey" PRIMARY KEY ("id"));
COMMENT ON COLUMN "physical_flow"."name" IS 'optional name, if provided this effectively overrides the associated specification name';

-- changeset dobra:1703194766143-27
CREATE TABLE "physical_specification" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "owning_entity_id" BIGINT NOT NULL, "external_id" VARCHAR(200) NOT NULL, "name" VARCHAR(255) NOT NULL, "format" VARCHAR(64) NOT NULL, "description" VARCHAR(4000) NOT NULL, "provenance" VARCHAR(64) NOT NULL, "owning_entity_kind" VARCHAR(64) DEFAULT 'APPLICATION' NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "is_removed" BOOLEAN DEFAULT FALSE NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "created_by" VARCHAR(255) NOT NULL, CONSTRAINT "physical_data_article_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-28
CREATE TABLE "actor" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(), "last_updated_by" VARCHAR(255) NOT NULL, "is_external" BOOLEAN DEFAULT FALSE NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "external_id" VARCHAR(200), CONSTRAINT "actor_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "actor" IS 'represents a non application entity, typically used in flows.  Examples include exchanges, departments, counterpart organisations';
COMMENT ON COLUMN "actor"."name" IS 'short name identifying the actor (i.e. Bank of England)';
COMMENT ON COLUMN "actor"."description" IS 'longer textual description of the actor';
COMMENT ON COLUMN "actor"."is_external" IS 'flag to indicate whether this is an internal actor (e.g. Chief Risk Officer) or external actor (e.g. Bank of England)';
COMMENT ON COLUMN "actor"."provenance" IS 'where did this actor record originate, will be ''waltz'' if provided via the UI';
COMMENT ON COLUMN "actor"."external_id" IS 'identifier this actor is known by externally.  Should not change, unlike the name which may change.';

-- changeset dobra:1703194766143-29
CREATE TABLE "involvement_kind" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "description" VARCHAR(4000) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(), "last_updated_by" VARCHAR(255) NOT NULL, "external_id" VARCHAR(200), "user_selectable" BOOLEAN DEFAULT TRUE NOT NULL, "subject_kind" VARCHAR(64) NOT NULL, "name" VARCHAR(255) NOT NULL, "permitted_role" VARCHAR(255), CONSTRAINT "involvement_kind_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "involvement_kind" IS 'defines a particular type of involvement a person may have in relation to an entity (e.g. IT Owner for an APPLICATION)';
COMMENT ON COLUMN "involvement_kind"."description" IS 'longer textual description of the involvement';
COMMENT ON COLUMN "involvement_kind"."external_id" IS 'external identifier, typically used when external jobs are updating the associated involvements';
COMMENT ON COLUMN "involvement_kind"."user_selectable" IS 'flag to allow users to add people to an entity with this involvement (set to false to restrict usage, i.e. if involvement is mastered in another system)';

-- changeset dobra:1703194766143-30
CREATE TABLE "measurable" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "parent_id" BIGINT, "name" VARCHAR(255) NOT NULL, "concrete" BOOLEAN DEFAULT TRUE NOT NULL, "description" VARCHAR(4000) NOT NULL, "external_id" VARCHAR(200), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(), "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) NOT NULL, "measurable_category_id" BIGINT, "external_parent_id" VARCHAR(200), "entity_lifecycle_status" VARCHAR(64) DEFAULT 'ACTIVE' NOT NULL, "organisational_unit_id" BIGINT, "position" INTEGER DEFAULT 0 NOT NULL, CONSTRAINT "measurable_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "measurable" IS 'defines a specific entry in a measurable category (e.g. a taxonomy item)';
COMMENT ON COLUMN "measurable"."id" IS 'unique identifier for this measurable record within waltz';
COMMENT ON COLUMN "measurable"."parent_id" IS 'the id of the parent measurable';
COMMENT ON COLUMN "measurable"."name" IS 'the name to show for this measurable item, should be relatively short';
COMMENT ON COLUMN "measurable"."concrete" IS 'indicates whether this node in the taxonomy should be viewed as abstract or concrete.  Abstract measurables are typically not usable in ratings etc.';
COMMENT ON COLUMN "measurable"."description" IS 'description of the measurable item, markdown supported';
COMMENT ON COLUMN "measurable"."external_id" IS 'identifier this measurable is known by externally.  Should not change, unlike the name which may change.';
COMMENT ON COLUMN "measurable"."last_updated_at" IS 'the datetime this measurable record was last updated';
COMMENT ON COLUMN "measurable"."last_updated_by" IS 'the last user to update this measurable record';
COMMENT ON COLUMN "measurable"."provenance" IS 'origination of this measurable record';
COMMENT ON COLUMN "measurable"."measurable_category_id" IS 'the category groups a set of related measurables into a single taxonomy, e.g. Process';
COMMENT ON COLUMN "measurable"."external_parent_id" IS 'external identifier of this items parent node, if available';
COMMENT ON COLUMN "measurable"."entity_lifecycle_status" IS 'the lifecycle state of this measurable record (one of: ACTIVE, PENDING, REMOVED)';
COMMENT ON COLUMN "measurable"."organisational_unit_id" IS 'The, optional, owner of this measurable';
COMMENT ON COLUMN "measurable"."position" IS 'numeric position of this measurable, overrides the natural sorting on name. Suggest these are assigned with gaps so that reorders are simpler, e.g. 10, 20, 30';

-- changeset dobra:1703194766143-31
CREATE TABLE "measurable_rating" ("entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "measurable_id" BIGINT NOT NULL, "rating" VARCHAR(3) NOT NULL, "description" VARCHAR(4000), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, "is_primary" BOOLEAN DEFAULT FALSE NOT NULL, "id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, CONSTRAINT "measurable_rating_pkey" PRIMARY KEY ("id"));
COMMENT ON COLUMN "measurable_rating"."entity_id" IS 'reference to the entity identifier being rated against the measurable';
COMMENT ON COLUMN "measurable_rating"."entity_kind" IS 'reference to the entity_kind (typically APPLICATION) being rated against the measurable';
COMMENT ON COLUMN "measurable_rating"."measurable_id" IS 'reference to the measurable being rated against the entity';
COMMENT ON COLUMN "measurable_rating"."rating" IS 'the rating code which identifies the rating scheme item used in the rating.  This needs the measurable category to determine which scheme the code belongs to';
COMMENT ON COLUMN "measurable_rating"."description" IS 'optional comment';
COMMENT ON COLUMN "measurable_rating"."last_updated_at" IS 'when the rating was last updated';
COMMENT ON COLUMN "measurable_rating"."last_updated_by" IS 'user that last updated the rating';
COMMENT ON COLUMN "measurable_rating"."provenance" IS 'where the rating came from, ''waltz'' if via the ui';
COMMENT ON COLUMN "measurable_rating"."is_readonly" IS 'flag to prevent updates via the UI';
COMMENT ON COLUMN "measurable_rating"."is_primary" IS 'flag to indicate the measurable is the primary one for the entity in it''s category';

-- changeset dobra:1703194766143-32
CREATE TABLE "survey_template" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "target_entity_kind" VARCHAR(64) NOT NULL, "owner_id" BIGINT NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "status" VARCHAR(64) NOT NULL, "external_id" VARCHAR(200), "issuance_role" VARCHAR(255), CONSTRAINT "survey_template_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "survey_template" IS 'defines a survey template, questions and runs will refer to this';
COMMENT ON COLUMN "survey_template"."id" IS 'identifier for this survey template (auto generated)';
COMMENT ON COLUMN "survey_template"."name" IS 'short name for this survey template';
COMMENT ON COLUMN "survey_template"."description" IS 'longer description for this template, supports markdown';
COMMENT ON COLUMN "survey_template"."target_entity_kind" IS 'defines what kind of entities this survey can be issued against.  Typically: APPLICATION or CHANGE_INITIATIVE';
COMMENT ON COLUMN "survey_template"."owner_id" IS 'person id of the owner of this template';
COMMENT ON COLUMN "survey_template"."created_at" IS 'date this template was created';
COMMENT ON COLUMN "survey_template"."status" IS 'describes the status of this template, which dictates whether it can be issued or modified. e.g. ACTIVE, DRAFT, OBSOLETE';
COMMENT ON COLUMN "survey_template"."external_id" IS 'external identifier for this template';
COMMENT ON COLUMN "survey_template"."issuance_role" IS 'the role required for a user to issue surveys against an entity, or to issue a run. If null, all users can issue this survey';

-- changeset dobra:1703194766143-33
CREATE TABLE "measurable_category" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000) NOT NULL, "external_id" VARCHAR(200), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(), "last_updated_by" VARCHAR(255) NOT NULL, "rating_scheme_id" BIGINT NOT NULL, "editable" BOOLEAN DEFAULT FALSE NOT NULL, "rating_editor_role" VARCHAR(64) DEFAULT 'RATING_EDITOR' NOT NULL, "constraining_assessment_definition_id" BIGINT, "position" INTEGER DEFAULT 0 NOT NULL, "icon_name" VARCHAR(64) DEFAULT 'puzzle-piece' NOT NULL, "allow_primary_ratings" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "measurable_category_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "measurable_category" IS 'groups a set of measurables together to form a basic hierarchical taxonomy';
COMMENT ON COLUMN "measurable_category"."id" IS 'unique identifier for this measurable_category record within waltz';
COMMENT ON COLUMN "measurable_category"."name" IS 'the name to show for this measurable category, should be relatively short';
COMMENT ON COLUMN "measurable_category"."external_id" IS 'identifier this measurable category is known by externally.  Should not change, unlike the name which may change.';
COMMENT ON COLUMN "measurable_category"."last_updated_at" IS 'the datetime this measurable record was last updated';
COMMENT ON COLUMN "measurable_category"."last_updated_by" IS 'the last user to update this measurable record';
COMMENT ON COLUMN "measurable_category"."rating_scheme_id" IS 'links the rating scheme which will be used when entities align to the measurables in this category (via measurable_rating)';
COMMENT ON COLUMN "measurable_category"."editable" IS 'can this taxonomy be edited in the Waltz UI';
COMMENT ON COLUMN "measurable_category"."rating_editor_role" IS 'limits users who cam edit this taxonomy';
COMMENT ON COLUMN "measurable_category"."constraining_assessment_definition_id" IS 'if the category and assessment share a rating scheme, this can be used to limit the maximum rating that can be given to measurable ratings (in this category)';
COMMENT ON COLUMN "measurable_category"."position" IS 'overrides the default (alphabetical) sort ordering of this category, defaults to zero, lower numbers come first';
COMMENT ON COLUMN "measurable_category"."icon_name" IS 'fontawesome icon name for the category, defaults to puzzle-piece';
COMMENT ON COLUMN "measurable_category"."allow_primary_ratings" IS 'boolean flag used to determine if the taxonomy supports marking ratings as primary for an application';

-- changeset dobra:1703194766143-34
CREATE TABLE "survey_run" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "survey_template_id" BIGINT NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "selector_entity_kind" VARCHAR(64) NOT NULL, "selector_entity_id" BIGINT NOT NULL, "selector_hierarchy_scope" VARCHAR(64) NOT NULL, "issued_on" date, "due_date" date NOT NULL, "issuance_kind" VARCHAR(64) NOT NULL, "owner_id" BIGINT NOT NULL, "contact_email" VARCHAR(255) NOT NULL, "status" VARCHAR(64) NOT NULL, "is_default" BOOLEAN DEFAULT FALSE NOT NULL, "approval_due_date" date NOT NULL, "recipient_involvement_group_id" BIGINT, "owner_involvement_group_id" BIGINT, CONSTRAINT "survey_run_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-35
CREATE TABLE "survey_instance" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "survey_run_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "entity_id" BIGINT NOT NULL, "status" VARCHAR(64) NOT NULL, "submitted_at" TIMESTAMP WITHOUT TIME ZONE, "submitted_by" VARCHAR(255), "due_date" date NOT NULL, "original_instance_id" BIGINT, "approved_at" TIMESTAMP WITHOUT TIME ZONE, "approved_by" VARCHAR(255), "owning_role" VARCHAR(255), "entity_qualifier_id" BIGINT, "entity_qualifier_kind" VARCHAR(64), "name" VARCHAR(255) DEFAULT '' NOT NULL, "approval_due_date" date NOT NULL, "issued_on" date DEFAULT CURRENT_DATE NOT NULL, CONSTRAINT "survey_instance_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-36
CREATE TABLE "survey_instance_recipient" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "survey_instance_id" BIGINT NOT NULL, "person_id" BIGINT NOT NULL, CONSTRAINT "survey_instance_recipient_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-37
CREATE TABLE "survey_question" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "survey_template_id" BIGINT NOT NULL, "question_text" VARCHAR(4000) NOT NULL, "field_type" VARCHAR(64) NOT NULL, "section_name" VARCHAR(255), "position" INTEGER NOT NULL, "is_mandatory" BOOLEAN NOT NULL, "allow_comment" BOOLEAN NOT NULL, "help_text" VARCHAR(4000), "external_id" VARCHAR(200), "inclusion_predicate" VARCHAR(500), "entity_qualifier_id" BIGINT, "entity_qualifier_kind" VARCHAR(64), "parent_external_id" VARCHAR(200), "label" VARCHAR(255), CONSTRAINT "survey_question_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-38
CREATE TABLE "physical_spec_defn" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "specification_id" BIGINT NOT NULL, "version" VARCHAR(64) NOT NULL, "delimiter" CHAR(1), "type" VARCHAR(64) NOT NULL, "provenance" VARCHAR(64) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "created_by" VARCHAR(255) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "status" VARCHAR(64) NOT NULL, CONSTRAINT "physical_spec_defn_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "physical_spec_defn" IS 'Stores physical spec definition records';

-- changeset dobra:1703194766143-39
CREATE TABLE "physical_spec_defn_field" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "spec_defn_id" BIGINT NOT NULL, "name" VARCHAR(255) NOT NULL, "position" INTEGER NOT NULL, "type" VARCHAR(64) NOT NULL, "description" VARCHAR(4000) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "logical_data_element_id" BIGINT, CONSTRAINT "physical_spec_defn_field_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "physical_spec_defn_field" IS 'Stores physical spec definition fields';

-- changeset dobra:1703194766143-40
CREATE TABLE "flow_diagram" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "layout_data" TEXT NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "is_removed" BOOLEAN DEFAULT FALSE NOT NULL, "editor_role" VARCHAR(64), CONSTRAINT "flow_diagram_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "flow_diagram" IS 'The flow diagram table represents the metadata and layout data associated with a flow diagram';

-- changeset dobra:1703194766143-41
CREATE TABLE "flow_diagram_entity" ("diagram_id" BIGINT NOT NULL, "entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "is_notable" BOOLEAN DEFAULT FALSE, CONSTRAINT "flow_diagram_entity_pkey" PRIMARY KEY ("diagram_id", "entity_id", "entity_kind"));
COMMENT ON TABLE "flow_diagram_entity" IS 'A Bill of Materials (BoM) for a flow diagram';

-- changeset dobra:1703194766143-42
CREATE TABLE "physical_spec_defn_sample_file" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "spec_defn_id" BIGINT NOT NULL, "name" VARCHAR(255) NOT NULL, "file_data" TEXT NOT NULL, CONSTRAINT "phy_spec_defn_sample_file_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "physical_spec_defn_sample_file" IS 'Stores physical spec definition sample file data';

-- changeset dobra:1703194766143-43
CREATE TABLE "flow_diagram_annotation" ("annotation_id" VARCHAR(64) NOT NULL, "diagram_id" BIGINT NOT NULL, "entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "note" VARCHAR(4000) NOT NULL);
COMMENT ON TABLE "flow_diagram_annotation" IS 'Annotations associated with a specific flow diagram';

-- changeset dobra:1703194766143-44
CREATE TABLE "entity_named_note" ("entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "named_note_type_id" BIGINT NOT NULL, "note_text" VARCHAR NOT NULL, "provenance" VARCHAR(64) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, CONSTRAINT "entity_named_note_pkey" PRIMARY KEY ("entity_id", "entity_kind", "named_note_type_id"));
COMMENT ON TABLE "entity_named_note" IS 'Named notes associated with entities';

-- changeset dobra:1703194766143-45
CREATE TABLE "physical_spec_data_type" ("specification_id" BIGINT NOT NULL, "data_type_id" BIGINT NOT NULL, "provenance" VARCHAR(64) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "physical_spec_data_type_pkey" PRIMARY KEY ("specification_id", "data_type_id"));
COMMENT ON TABLE "physical_spec_data_type" IS 'Decorates physical specs with data types';

-- changeset dobra:1703194766143-46
CREATE TABLE "entity_named_note_type" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "applicable_entity_kinds" VARCHAR(255) NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000) NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, "position" INTEGER DEFAULT 0 NOT NULL, "external_id" VARCHAR(200), CONSTRAINT "entity_named_note_type_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "entity_named_note_type" IS 'Named note types that can associated with entities';

-- changeset dobra:1703194766143-47
CREATE TABLE "enum_value" ("type" VARCHAR(64) NOT NULL, "key" VARCHAR(64) NOT NULL, "display_name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000) NOT NULL, "icon_name" VARCHAR(64) DEFAULT 'fw' NOT NULL, "position" INTEGER DEFAULT 0 NOT NULL, "icon_color" VARCHAR(64) DEFAULT 'none' NOT NULL, CONSTRAINT "enum_value_pkey" PRIMARY KEY ("type", "key"));
COMMENT ON TABLE "enum_value" IS 'Store enum values - display names, descriptions and icon names';
COMMENT ON COLUMN "enum_value"."icon_name" IS 'The default value fw, stands for fixed-width which acts like a spacer icon';

-- changeset dobra:1703194766143-48
CREATE TABLE "attestation_instance_recipient" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "attestation_instance_id" BIGINT NOT NULL, "user_id" VARCHAR(255) NOT NULL, CONSTRAINT "attestation_instance_recipient_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "attestation_instance_recipient" IS 'associates an attestation instance to a user who is responsible for doing the attestation';
COMMENT ON COLUMN "attestation_instance_recipient"."attestation_instance_id" IS 'reference to the attestation instance';
COMMENT ON COLUMN "attestation_instance_recipient"."user_id" IS 'the user responsible for doing the attestations';

-- changeset dobra:1703194766143-49
CREATE TABLE "entity_workflow_state" ("workflow_id" BIGINT, "entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "state" VARCHAR(64) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) NOT NULL, "description" VARCHAR(4000));
COMMENT ON TABLE "entity_workflow_state" IS 'Store entity workflow states';

-- changeset dobra:1703194766143-50
CREATE TABLE "entity_workflow_transition" ("workflow_id" BIGINT, "entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "from_state" VARCHAR(64), "to_state" VARCHAR(64) NOT NULL, "reason" VARCHAR(4000), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) NOT NULL);
COMMENT ON TABLE "entity_workflow_transition" IS 'Store entity workflow transitions';

-- changeset dobra:1703194766143-51
CREATE TABLE "entity_enum_definition" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "icon_name" VARCHAR(64) DEFAULT 'fw' NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "enum_value_type" VARCHAR(64) NOT NULL, "position" INTEGER DEFAULT 0 NOT NULL, "is_editable" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "entity_enum_defn_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "entity_enum_definition" IS 'Store entity enum definitions';
COMMENT ON COLUMN "entity_enum_definition"."icon_name" IS 'The default value fw, stands for fixed-width which acts like a spacer icon';

-- changeset dobra:1703194766143-52
CREATE TABLE "entity_enum_value" ("definition_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "entity_id" BIGINT NOT NULL, "enum_value_key" VARCHAR(64) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) NOT NULL);
COMMENT ON TABLE "entity_enum_value" IS 'Store entity enum values';

-- changeset dobra:1703194766143-53
CREATE TABLE "logical_data_element" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "external_id" VARCHAR(200), "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "type" VARCHAR(64) NOT NULL, "provenance" VARCHAR(64) NOT NULL, "entity_lifecycle_status" VARCHAR(64) DEFAULT 'ACTIVE' NOT NULL, "parent_data_type_id" BIGINT DEFAULT -1 NOT NULL, CONSTRAINT "logical_data_element_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-54
CREATE TABLE "shared_preference" ("key" VARCHAR(120) NOT NULL, "category" VARCHAR(128) NOT NULL, "value" VARCHAR(4000) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, CONSTRAINT "shared_preference_pkey" PRIMARY KEY ("key", "category"));
COMMENT ON TABLE "shared_preference" IS 'Store shared preference values';

-- changeset dobra:1703194766143-55
CREATE TABLE "rating_scheme_item" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "scheme_id" BIGINT NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000) NOT NULL, "code" VARCHAR(3) NOT NULL, "color" VARCHAR(255) NOT NULL, "position" INTEGER DEFAULT 0 NOT NULL, "user_selectable" BOOLEAN DEFAULT TRUE NOT NULL, "external_id" VARCHAR(200), "rating_group" VARCHAR(255), CONSTRAINT "rating_definition_item_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "rating_scheme_item" IS 'Used to enumerate the individual ratings which are part of a rating scheme';
COMMENT ON COLUMN "rating_scheme_item"."id" IS 'autogenerated identifier';
COMMENT ON COLUMN "rating_scheme_item"."scheme_id" IS 'the parent scheme for this item';
COMMENT ON COLUMN "rating_scheme_item"."name" IS 'display name for the item';
COMMENT ON COLUMN "rating_scheme_item"."description" IS 'description of the item';
COMMENT ON COLUMN "rating_scheme_item"."code" IS 'short code to identify the item, long term plan is to replace by external_id in future version of waltz';
COMMENT ON COLUMN "rating_scheme_item"."color" IS 'color to use when rendering as a cell';
COMMENT ON COLUMN "rating_scheme_item"."position" IS 'overrides the natural alphabetical sorting';
COMMENT ON COLUMN "rating_scheme_item"."user_selectable" IS 'used to restrict ratings that should not be manually assigned';
COMMENT ON COLUMN "rating_scheme_item"."external_id" IS 'external identifier for this rating scheme item';
COMMENT ON COLUMN "rating_scheme_item"."rating_group" IS 'used to visually group items in dropdowns etc.';

-- changeset dobra:1703194766143-56
CREATE TABLE "assessment_definition" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "external_id" VARCHAR(200), "rating_scheme_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "description" VARCHAR(4000), "permitted_role" VARCHAR(255), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, "provenance" VARCHAR(64) NOT NULL, "visibility" VARCHAR(64) DEFAULT 'PRIMARY' NOT NULL, "definition_group" VARCHAR(255) DEFAULT 'Uncategorized' NOT NULL, "qualifier_kind" VARCHAR(64), "qualifier_id" BIGINT, "cardinality" VARCHAR(64) DEFAULT 'ZERO_ONE' NOT NULL, CONSTRAINT "assessment_definition_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "assessment_definition" IS 'assessments are used to record enumerated data points against apps. The definition describes each type of definition, linking to the applicable entity types and possible values.';
COMMENT ON COLUMN "assessment_definition"."name" IS 'display name for this assessment definition';
COMMENT ON COLUMN "assessment_definition"."external_id" IS 'external identifier, typically used when external jobs are updating the associated ratings';
COMMENT ON COLUMN "assessment_definition"."rating_scheme_id" IS 'reference to the rating scheme which provides the acceptable values for this assessment';
COMMENT ON COLUMN "assessment_definition"."entity_kind" IS 'the kind of entity the assessment can be associated with (typically the _main_ entities: APPLICATION, CHANGE_INITIATIVE, etc';
COMMENT ON COLUMN "assessment_definition"."description" IS 'longer description of this assessment.  Markdown is supported';
COMMENT ON COLUMN "assessment_definition"."permitted_role" IS 'if defined, only users with this role can update the definition';
COMMENT ON COLUMN "assessment_definition"."is_readonly" IS 'flag inidcating that the record is read only.  Typically set if the assessment values are mastered outside of Waltz and updated via an external job';
COMMENT ON COLUMN "assessment_definition"."provenance" IS 'where this definition came from.  Will be ''waltz'' if created via the UI';
COMMENT ON COLUMN "assessment_definition"."visibility" IS 'indicates if this assessment should be included in the users primary, short-list by default (permissible values are: PRIMARY, SECONDARY).  Note: users are free to remove assessments from their short lists.';
COMMENT ON COLUMN "assessment_definition"."definition_group" IS 'Used to categorized assessments into a basic 2 level tree, useful when the number of assessments gets large';
COMMENT ON COLUMN "assessment_definition"."qualifier_kind" IS 'An optional reference a qualifier kind, to further identify where this assessment is applicable';
COMMENT ON COLUMN "assessment_definition"."qualifier_id" IS 'An optional reference a qualifier id, to further identify where this assessment is applicable';
COMMENT ON COLUMN "assessment_definition"."cardinality" IS 'indicates the number of permitted ratings per entity, One of: ZERO_ONE, ZERO_MANY';

-- changeset dobra:1703194766143-57
CREATE TABLE "assessment_rating" ("entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "assessment_definition_id" BIGINT NOT NULL, "rating_id" BIGINT NOT NULL, "description" VARCHAR(4000), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, "id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, CONSTRAINT "assessment_rating_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "assessment_rating" IS 'an individual rating, linking an entity (e.g. app) to an assessment and value';
COMMENT ON COLUMN "assessment_rating"."entity_id" IS 'the entity id of the entity being assessed and rated';
COMMENT ON COLUMN "assessment_rating"."entity_kind" IS 'the entity kind of the entity being assessed and rated (typically APPLICATION or CHANGE_INITIATVE)';
COMMENT ON COLUMN "assessment_rating"."assessment_definition_id" IS 'reference to the assessment definition being assessed for this rating record';
COMMENT ON COLUMN "assessment_rating"."rating_id" IS 'reference to the rating scheme item, providing the value of this assessment rating. Note: this should be one of the scheme items defined within the rating scheme of the assessment definition';
COMMENT ON COLUMN "assessment_rating"."description" IS 'optional user provided comment';
COMMENT ON COLUMN "assessment_rating"."provenance" IS 'where this rating came from.  Will be ''waltz'' if created via the UI';
COMMENT ON COLUMN "assessment_rating"."is_readonly" IS 'Specifically lock this rating, note the readonly value with the associated definition takes precedence';
COMMENT ON COLUMN "assessment_rating"."id" IS 'auto generated identifier';

-- changeset dobra:1703194766143-58
CREATE TABLE "svg_diagram" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "group" VARCHAR(128) NOT NULL, "priority" INTEGER NOT NULL, "description" TEXT, "svg" TEXT NOT NULL, "key_property" VARCHAR(64) NOT NULL, "product" VARCHAR(64) NOT NULL, "display_width_percent" INTEGER, "display_height_percent" INTEGER, CONSTRAINT "svg_diagram_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-59
CREATE TABLE "roadmap" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "row_type_kind" VARCHAR(64) NOT NULL, "rating_scheme_id" BIGINT NOT NULL, "row_type_id" BIGINT NOT NULL, "column_type_kind" VARCHAR(64) NOT NULL, "column_type_id" BIGINT NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "entity_lifecycle_status" VARCHAR(64) DEFAULT 'ACTIVE' NOT NULL, CONSTRAINT "roadmap_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-60
CREATE TABLE "scenario" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "lifecycle_status" VARCHAR(64) NOT NULL, "roadmap_id" BIGINT NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "effective_date" date NOT NULL, "scenario_type" VARCHAR(64) DEFAULT 'TARGET' NOT NULL, "release_status" VARCHAR(64) DEFAULT 'ACTIVE' NOT NULL, "position" INTEGER DEFAULT 0 NOT NULL, CONSTRAINT "scenario_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-61
CREATE TABLE "scenario_rating_item" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "scenario_id" BIGINT NOT NULL, "rating" CHAR(1) NOT NULL, "domain_item_kind" VARCHAR(64) NOT NULL, "domain_item_id" BIGINT NOT NULL, "row_kind" VARCHAR(64) NOT NULL, "row_id" BIGINT NOT NULL, "column_kind" VARCHAR(64) NOT NULL, "column_id" BIGINT NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), CONSTRAINT "scenario_rating_item_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-62
CREATE TABLE "scenario_axis_item" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "orientation" VARCHAR(64) NOT NULL, "scenario_id" BIGINT NOT NULL, "position" INTEGER NOT NULL, "domain_item_kind" VARCHAR(64) NOT NULL, "domain_item_id" BIGINT NOT NULL, CONSTRAINT "scenario_axis_item_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-63
CREATE TABLE "person" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "employee_id" VARCHAR(128), "display_name" VARCHAR(255) NOT NULL, "email" VARCHAR(255) NOT NULL, "user_principal_name" VARCHAR(255), "department_name" VARCHAR(255), "kind" VARCHAR(255) NOT NULL, "manager_employee_id" VARCHAR(128), "title" VARCHAR(255), "office_phone" VARCHAR(128), "mobile_phone" VARCHAR(128), "organisational_unit_id" BIGINT, "is_removed" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "person_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-64
CREATE TABLE "taxonomy_change" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "change_type" VARCHAR(64) NOT NULL, "description" VARCHAR(4000), "domain_kind" VARCHAR(64) NOT NULL, "domain_id" BIGINT NOT NULL, "primary_reference_kind" VARCHAR(64) NOT NULL, "primary_reference_id" BIGINT NOT NULL, "status" VARCHAR(64) DEFAULT 'DRAFT' NOT NULL, "params" VARCHAR(4000) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "created_by" VARCHAR(255) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, CONSTRAINT "taxonomy_change_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-65
CREATE TABLE "client_cache_key" ("key" VARCHAR(255) NOT NULL, "guid" VARCHAR(64) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, CONSTRAINT "cache_key_pkey" PRIMARY KEY ("key"));

-- changeset dobra:1703194766143-66
CREATE TABLE "server_usage" ("server_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "entity_id" BIGINT NOT NULL, "environment" VARCHAR(64) DEFAULT 'UNKNOWN' NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) NOT NULL, "id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, CONSTRAINT "server_usage_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-67
CREATE TABLE "physical_flow_participant" ("physical_flow_id" BIGINT NOT NULL, "kind" VARCHAR(64) NOT NULL, "participant_entity_kind" VARCHAR(64) NOT NULL, "participant_entity_id" BIGINT NOT NULL, "description" VARCHAR(4000), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) NOT NULL);

-- changeset dobra:1703194766143-68
CREATE TABLE "thumbnail" ("parent_entity_kind" VARCHAR(64) NOT NULL, "parent_entity_id" BIGINT NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "mime_type" VARCHAR(255) NOT NULL, "blob" BYTEA NOT NULL, "external_id" VARCHAR(200), "provenance" VARCHAR(64) NOT NULL);

-- changeset dobra:1703194766143-69
CREATE TABLE "allocation" ("allocation_scheme_id" BIGINT NOT NULL, "allocation_percentage" INTEGER DEFAULT 0 NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "external_id" VARCHAR(200), "provenance" VARCHAR(64) NOT NULL, "measurable_rating_id" BIGINT NOT NULL, "id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, CONSTRAINT "allocation_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "allocation" IS 'allocations are used to apportion shares of a particular scheme (i.e. TCO) against an entity (e.g. applications) and measurable.  The total for a given scheme and entity should be lte 100';
COMMENT ON COLUMN "allocation"."allocation_scheme_id" IS 'identifier (and fk) to a particular allocation scheme';
COMMENT ON COLUMN "allocation"."allocation_percentage" IS 'the allocation percentage given to this entity/measurable';

-- changeset dobra:1703194766143-70
CREATE TABLE "change_set" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "parent_entity_kind" VARCHAR(64), "parent_entity_id" BIGINT, "planned_date" TIMESTAMP WITHOUT TIME ZONE, "entity_lifecycle_status" VARCHAR(64) DEFAULT 'ACTIVE' NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "external_id" VARCHAR(200), "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "change_set_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "change_set" IS 'a logical grouping of smaller change units that belong to a parent entity';
COMMENT ON COLUMN "change_set"."id" IS 'unique identifier for this change set record within waltz';
COMMENT ON COLUMN "change_set"."parent_entity_kind" IS 'the kind of entity that owns this change set';
COMMENT ON COLUMN "change_set"."parent_entity_id" IS 'the identifier for the entity that owns this change set';
COMMENT ON COLUMN "change_set"."planned_date" IS 'the planned date for the completion of the change set';
COMMENT ON COLUMN "change_set"."entity_lifecycle_status" IS 'the lifecycle state of this entity record (one of: ACTIVE, PENDING, REMOVED)';
COMMENT ON COLUMN "change_set"."name" IS 'the name of this change set';
COMMENT ON COLUMN "change_set"."description" IS 'longer description to provide more information about this change set.  Markdown is supported';
COMMENT ON COLUMN "change_set"."last_updated_at" IS 'the datetime this record was last updated';
COMMENT ON COLUMN "change_set"."last_updated_by" IS 'the last user to update this change set record';
COMMENT ON COLUMN "change_set"."external_id" IS 'external identifier for this change set';
COMMENT ON COLUMN "change_set"."provenance" IS 'origination of this change set record';

-- changeset dobra:1703194766143-71
CREATE TABLE "change_unit" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "change_set_id" BIGINT, "subject_entity_kind" VARCHAR(64) NOT NULL, "subject_entity_id" BIGINT NOT NULL, "subject_initial_status" VARCHAR(64) NOT NULL, "action" VARCHAR(64) NOT NULL, "execution_status" VARCHAR(64) DEFAULT 'PENDING' NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "external_id" VARCHAR(200), "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "change_unit_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "change_unit" IS 'a smaller unit of change that describes an activation, retirement or modification of an entity';
COMMENT ON COLUMN "change_unit"."id" IS 'unique identifier for this change unit record within waltz';
COMMENT ON COLUMN "change_unit"."change_set_id" IS 'the reference to the change set that this change unit belongs to';
COMMENT ON COLUMN "change_unit"."subject_entity_kind" IS 'the kind of entity that is being changed';
COMMENT ON COLUMN "change_unit"."subject_entity_id" IS 'the entity which is being changed';
COMMENT ON COLUMN "change_unit"."subject_initial_status" IS 'the lifecycle status of the entity before the change (one of: ACTIVE, PENDING, REMOVED)';
COMMENT ON COLUMN "change_unit"."action" IS 'describes the type of change taking place (one of: ACTIVATE, RETIRE, MODIFY)';
COMMENT ON COLUMN "change_unit"."execution_status" IS 'the state of the change unit (one of:  PENDING, COMPLETE, DISCARDED)';
COMMENT ON COLUMN "change_unit"."name" IS 'the name of this change unit';
COMMENT ON COLUMN "change_unit"."description" IS 'longer description to provide more information about this change set.  Markdown is supported';
COMMENT ON COLUMN "change_unit"."last_updated_at" IS 'the datetime this change unit record was last updated';
COMMENT ON COLUMN "change_unit"."last_updated_by" IS 'the last user to update this change unit record';
COMMENT ON COLUMN "change_unit"."external_id" IS 'external identifier for this change unit';
COMMENT ON COLUMN "change_unit"."provenance" IS 'origination of this change unit record';

-- changeset dobra:1703194766143-72
CREATE TABLE "attribute_change" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "change_unit_id" BIGINT NOT NULL, "type" VARCHAR(64) NOT NULL, "new_value" VARCHAR(4000), "old_value" VARCHAR(4000), "name" VARCHAR(255) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "attribute_change_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-73
CREATE TABLE "licence" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "external_id" VARCHAR(200), "approval_status" VARCHAR(64), "created_by" VARCHAR(255) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "licence_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-74
CREATE TABLE "external_identifier" ("entity_kind" VARCHAR(64) NOT NULL, "entity_id" BIGINT NOT NULL, "system" VARCHAR(64) NOT NULL, "external_id" VARCHAR(200) NOT NULL);

-- changeset dobra:1703194766143-75
CREATE TABLE "tag" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "target_kind" VARCHAR(64) NOT NULL, CONSTRAINT "tag_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-76
CREATE TABLE "tag_usage" ("tag_id" BIGINT NOT NULL, "entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "created_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "tag_usage_pkey" PRIMARY KEY ("tag_id", "entity_id", "entity_kind"));

-- changeset dobra:1703194766143-77
CREATE TABLE "allocation_scheme" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000) NOT NULL, "measurable_category_id" BIGINT NOT NULL, "external_id" VARCHAR(200) DEFAULT 'TEMP' NOT NULL, CONSTRAINT "alloc_scheme_definition_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "allocation_scheme" IS 'allocation_schemes provide a named definition which allows entities to record allocations against a particular measurable category. (e.g. the ''Function Cost Shred'' would be for applications to record allocations against their Functional Taxonomy measurable mappings)';
COMMENT ON COLUMN "allocation_scheme"."name" IS 'short name describing this allocation scheme (i.e. ''Function Cost Shred'')';
COMMENT ON COLUMN "allocation_scheme"."description" IS 'longer description to provide more information about this allocation scheme';
COMMENT ON COLUMN "allocation_scheme"."measurable_category_id" IS 'defines the category of measurables this allocation scheme refers to';
COMMENT ON COLUMN "allocation_scheme"."external_id" IS 'typically used when setting allocations via external batch processes (e.g. ''FT_COST'')';

-- changeset dobra:1703194766143-78
CREATE TABLE "software_version" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "software_package_id" BIGINT NOT NULL, "version" VARCHAR(64), "description" VARCHAR(4000), "external_id" VARCHAR(200), "created_by" VARCHAR(255) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "provenance" VARCHAR(64) NOT NULL, "release_date" date, CONSTRAINT "software_version_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-79
CREATE TABLE "software_usage" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "application_id" BIGINT NOT NULL, "software_version_id" BIGINT NOT NULL, "created_by" VARCHAR(255) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "software_usage_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-80
CREATE TABLE "software_version_licence" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "software_version_id" BIGINT NOT NULL, "licence_id" BIGINT NOT NULL, "created_by" VARCHAR(255) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "software_version_licence_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-81
CREATE TABLE "attestation_instance" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "attestation_run_id" BIGINT NOT NULL, "parent_entity_id" BIGINT NOT NULL, "parent_entity_kind" VARCHAR(64) NOT NULL, "attested_at" TIMESTAMP WITHOUT TIME ZONE, "attested_by" VARCHAR(255), "attested_entity_kind" VARCHAR(64) NOT NULL, CONSTRAINT "attestation_instance_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "attestation_instance" IS 'a specific attestation of an entity for a particular kind (e.g. an APPLICATION for LOGICAL_FLOWs)';
COMMENT ON COLUMN "attestation_instance"."attestation_run_id" IS 'reference to the attestation run which owns this instance';
COMMENT ON COLUMN "attestation_instance"."parent_entity_id" IS 'the identifier of the entity being attested';
COMMENT ON COLUMN "attestation_instance"."parent_entity_kind" IS 'the type of entity being attested';
COMMENT ON COLUMN "attestation_instance"."attested_at" IS 'the date/time the attestation occured';
COMMENT ON COLUMN "attestation_instance"."attested_by" IS 'who initiated the attestation';
COMMENT ON COLUMN "attestation_instance"."attested_entity_kind" IS 'what was being attested for the parent entity (typically: MEASURABLE, LOGICAL_FLOW, PHYSICAL_FLOW)';

-- changeset dobra:1703194766143-82
CREATE TABLE "measurable_rating_planned_decommission" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "planned_decommission_date" date NOT NULL, "created_by" VARCHAR(255) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "updated_by" VARCHAR(255) NOT NULL, "updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "measurable_rating_id" BIGINT NOT NULL, CONSTRAINT "measurable_rating_planned_decommission_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-83
CREATE TABLE "measurable_rating_replacement" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "decommission_id" BIGINT NOT NULL, "planned_commission_date" date NOT NULL, "entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "created_by" VARCHAR(255) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "updated_by" VARCHAR(255) NOT NULL, "updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, CONSTRAINT "measurable_rating_replacement_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-84
CREATE TABLE "survey_question_list_response" ("survey_instance_id" BIGINT NOT NULL, "question_id" BIGINT NOT NULL, "response" VARCHAR NOT NULL, "position" INTEGER DEFAULT 0 NOT NULL, "entity_id" BIGINT, "entity_kind" VARCHAR(64));

-- changeset dobra:1703194766143-85
CREATE TABLE "relationship_kind" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "kind_a" VARCHAR(128) NOT NULL, "kind_b" VARCHAR(128) NOT NULL, "category_a" BIGINT, "category_b" BIGINT, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, "code" VARCHAR(128) NOT NULL, "position" INTEGER DEFAULT 0 NOT NULL, "reverse_name" VARCHAR(255) NOT NULL, CONSTRAINT "relationship_kind_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "relationship_kind" IS 'Describes types of relationships between entities';
COMMENT ON COLUMN "relationship_kind"."category_a" IS 'Placeholder: if kind_a is a MEASURABLE then this may (optionally) be used to restrict it based on category';
COMMENT ON COLUMN "relationship_kind"."category_b" IS 'Placeholder: if kind_b is a MEASURABLE then this may (optionally) be used to restrict it based on category';

-- changeset dobra:1703194766143-86
CREATE TABLE "application_group_entry" ("group_id" BIGINT NOT NULL, "application_id" BIGINT NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, CONSTRAINT "application_group_entry_pkey" PRIMARY KEY ("group_id", "application_id"));
COMMENT ON TABLE "application_group_entry" IS 'a reference to a specific application in a group';
COMMENT ON COLUMN "application_group_entry"."group_id" IS 'reference to the group this entry belongs to';
COMMENT ON COLUMN "application_group_entry"."application_id" IS 'reference to the application this entry refers to';
COMMENT ON COLUMN "application_group_entry"."is_readonly" IS 'flag to indicate that the value is readonly.  Typically set if group entries are added by external jobs';
COMMENT ON COLUMN "application_group_entry"."provenance" IS 'indicates where this record originated. Will be ''waltz'' if created via the UI';
COMMENT ON COLUMN "application_group_entry"."created_at" IS 'the date this entry was created, sometimes used to ''age'' entries out the group, i.e. in exception lists';

-- changeset dobra:1703194766143-87
CREATE TABLE "application_group_ou_entry" ("group_id" BIGINT NOT NULL, "org_unit_id" BIGINT NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, CONSTRAINT "app_group_ou_entry_pkey" PRIMARY KEY ("group_id", "org_unit_id"));
COMMENT ON TABLE "application_group_ou_entry" IS 'app groups can include reference to org units. Apps associated to the org unit are included in the group at runtime';
COMMENT ON COLUMN "application_group_ou_entry"."group_id" IS 'reference to the group this entry belongs to';
COMMENT ON COLUMN "application_group_ou_entry"."org_unit_id" IS 'reference to the org unit this entry belongs to';
COMMENT ON COLUMN "application_group_ou_entry"."is_readonly" IS 'flag to indicate that the value is readonly.  Typically set if group entries are added by external jobs';
COMMENT ON COLUMN "application_group_ou_entry"."provenance" IS 'indicates where this record originated. Will be ''waltz'' if created via the UI';
COMMENT ON COLUMN "application_group_ou_entry"."created_at" IS 'the date this entry was created';

-- changeset dobra:1703194766143-88
CREATE TABLE "vulnerability" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "external_id" VARCHAR(200) NOT NULL, "severity" VARCHAR(64) NOT NULL, "description" VARCHAR(4000), "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "vulnerability_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-89
CREATE TABLE "software_version_vulnerability" ("software_version_id" BIGINT NOT NULL, "vulnerability_id" BIGINT NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "provenance" VARCHAR(64) NOT NULL);

-- changeset dobra:1703194766143-90
CREATE TABLE "report_grid" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "external_id" VARCHAR(200) NOT NULL, "kind" VARCHAR(64) DEFAULT 'PUBLIC' NOT NULL, "subject_kind" VARCHAR(200) NOT NULL, CONSTRAINT "report_grid_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-91
CREATE TABLE "report_grid_fixed_column_definition" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "column_entity_kind" VARCHAR(64) NOT NULL, "column_entity_id" BIGINT, "display_name" VARCHAR(255), "additional_column_options" VARCHAR(64) DEFAULT 'NONE' NOT NULL, "entity_field_reference_id" BIGINT, "column_qualifier_kind" VARCHAR(64), "column_qualifier_id" BIGINT, "external_id" VARCHAR(200), "grid_column_id" BIGINT NOT NULL, CONSTRAINT "report_grid_fixed_column_defn_pkey" PRIMARY KEY ("id"));
COMMENT ON COLUMN "report_grid_fixed_column_definition"."column_qualifier_kind" IS 'An optional reference a qualifier kind, to further identify this item of grid data';
COMMENT ON COLUMN "report_grid_fixed_column_definition"."column_qualifier_id" IS 'An optional reference a qualifier id, to further identify this item of grid data';

-- changeset dobra:1703194766143-92
CREATE TABLE "permission_group" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "external_id" VARCHAR(200) NOT NULL, "description" VARCHAR(4000), "provenance" VARCHAR(64) NOT NULL, "is_default" BOOLEAN DEFAULT TRUE NOT NULL, CONSTRAINT "permission_group_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "permission_group" IS 'group describing the permissions different involvement kinds have against waltz entities';
COMMENT ON COLUMN "permission_group"."id" IS 'unique identifier for this cost record within waltz';
COMMENT ON COLUMN "permission_group"."name" IS 'name of the permission group';
COMMENT ON COLUMN "permission_group"."external_id" IS 'external identifier for this permission group';
COMMENT ON COLUMN "permission_group"."description" IS 'longer description to provide more information about this permission group';
COMMENT ON COLUMN "permission_group"."provenance" IS 'origination of this permission group';
COMMENT ON COLUMN "permission_group"."is_default" IS 'flag to identify the default permission group';

-- changeset dobra:1703194766143-93
CREATE TABLE "cost_kind" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "is_default" BOOLEAN DEFAULT FALSE NOT NULL, "external_id" VARCHAR(200) NOT NULL, "subject_kind" VARCHAR(64) DEFAULT 'APPLICATION' NOT NULL, CONSTRAINT "cost_kind_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "cost_kind" IS 'different types of cost can be linked to an entity in waltz, the cost kind describes the type';
COMMENT ON COLUMN "cost_kind"."id" IS 'unique identifier for this cost kind record within waltz';
COMMENT ON COLUMN "cost_kind"."name" IS 'the name of the cost kind';
COMMENT ON COLUMN "cost_kind"."description" IS 'longer description to provide more information about this cost kind';
COMMENT ON COLUMN "cost_kind"."is_default" IS 'indicates the cost kind to be shown on the entity overview by default';
COMMENT ON COLUMN "cost_kind"."external_id" IS 'external identifier for this cost kind';
COMMENT ON COLUMN "cost_kind"."subject_kind" IS 'the kind of subject that this cost is related to, e.g. APPLICATION, MEASURABLE_RATING, etc.';

-- changeset dobra:1703194766143-94
CREATE TABLE "cost" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "cost_kind_id" BIGINT NOT NULL, "entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "year" INTEGER NOT NULL, "amount" numeric(16, 2) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, CONSTRAINT "cost_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "cost" IS 'cost value belonging to an entity, given for a specified kind';
COMMENT ON COLUMN "cost"."id" IS 'unique identifier for this cost record within waltz';
COMMENT ON COLUMN "cost"."cost_kind_id" IS 'the type of cost the value relates to';
COMMENT ON COLUMN "cost"."entity_id" IS 'the identifier for the entity the cost belongs to';
COMMENT ON COLUMN "cost"."entity_kind" IS 'the kind of entity the cost belongs to';
COMMENT ON COLUMN "cost"."year" IS 'the year the cost value relates to';
COMMENT ON COLUMN "cost"."amount" IS 'the value of the cost (2 decimal places)';
COMMENT ON COLUMN "cost"."last_updated_at" IS 'the datetime this cost record was last updated';
COMMENT ON COLUMN "cost"."last_updated_by" IS 'the last user to update this cost record';
COMMENT ON COLUMN "cost"."provenance" IS 'origination of this cost record';

-- changeset dobra:1703194766143-95
CREATE TABLE "attestation_run" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "target_entity_kind" VARCHAR(64) NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "selector_entity_kind" VARCHAR(64) NOT NULL, "selector_entity_id" BIGINT NOT NULL, "selector_hierarchy_scope" VARCHAR(64) NOT NULL, "issued_by" VARCHAR(255), "issued_on" date, "due_date" date NOT NULL, "attested_entity_kind" VARCHAR(64) NOT NULL, "attested_entity_id" BIGINT, "status" VARCHAR(64) DEFAULT 'ISSUED' NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "recipient_involvement_group_id" BIGINT, CONSTRAINT "attestation_run_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "attestation_run" IS 'an attestation run defines the parameters needed to orchestrate an attestation cycle against multiple entities';
COMMENT ON COLUMN "attestation_run"."target_entity_kind" IS 'the kind of entities which are being attested (i.e. APPLICATION or CHANGE_INITIAIVE)';
COMMENT ON COLUMN "attestation_run"."name" IS 'display name for the run';
COMMENT ON COLUMN "attestation_run"."description" IS 'descriptive text for the run. Markdown is supported';
COMMENT ON COLUMN "attestation_run"."selector_entity_kind" IS 'the selector defines which entity is used to derive the set of entities (e.g. apps) being attested. This is the kind of that selector entity (e.g. ORG_UNIT)';
COMMENT ON COLUMN "attestation_run"."selector_entity_id" IS 'the selector defines which entity is used to derive the set of entities (e.g. apps) being attested. This is the id of that selector entity (e.g. 32)';
COMMENT ON COLUMN "attestation_run"."selector_hierarchy_scope" IS 'if the selector points at a hierarchical entity, this part indicates whether to match against EXACT, CHILDREN, or PARENT entities';
COMMENT ON COLUMN "attestation_run"."issued_by" IS 'user id of the issuer';
COMMENT ON COLUMN "attestation_run"."issued_on" IS 'the date the attestation was issued';
COMMENT ON COLUMN "attestation_run"."due_date" IS 'the date the attestations should be completed by';
COMMENT ON COLUMN "attestation_run"."attested_entity_kind" IS 'indicates what releated entity is being attestated for the target entity kind.  e.g. LOGICAL_FLOW, MEASURABLE_CATEGORY';
COMMENT ON COLUMN "attestation_run"."attested_entity_id" IS 'if the attested entity kind needs a qualifier then this optional identifier provides that (e.g. category 12)';
COMMENT ON COLUMN "attestation_run"."status" IS 'status of the attestation run (one of: DRAFT, PENDING, ISSUING, ISSUED, INVALID)';
COMMENT ON COLUMN "attestation_run"."provenance" IS 'where this run came from.  Will be ''waltz'' if created via the UI';

-- changeset dobra:1703194766143-96
CREATE TABLE "complexity_kind" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "external_id" VARCHAR(200), "is_default" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "complexity_kind_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "complexity_kind" IS 'complexity can be used to give a decimal score for an entity in waltz against a complexity kind (e.g. Flow Complexity). The complexity kind describes the type of complexity being evaluated.';
COMMENT ON COLUMN "complexity_kind"."id" IS 'unique identifier for this complexity kind record within waltz';
COMMENT ON COLUMN "complexity_kind"."name" IS 'the name of this complexity kind';
COMMENT ON COLUMN "complexity_kind"."description" IS 'longer description to provide more information about this complexity kind';
COMMENT ON COLUMN "complexity_kind"."external_id" IS 'external identifier for this complexity kind';
COMMENT ON COLUMN "complexity_kind"."is_default" IS 'indicates the complexity kind to be shown on the entity overview by default';

-- changeset dobra:1703194766143-97
CREATE TABLE "complexity" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "complexity_kind_id" BIGINT NOT NULL, "entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "score" numeric(10, 3) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, CONSTRAINT "complexity_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "complexity" IS 'a score of a given complexity kind for an entity in waltz';
COMMENT ON COLUMN "complexity"."id" IS 'unique identifier for this complexity record within waltz';
COMMENT ON COLUMN "complexity"."complexity_kind_id" IS 'the reference to the complexity kind that describes this score';
COMMENT ON COLUMN "complexity"."entity_id" IS 'the identifier for the entity this score belongs to';
COMMENT ON COLUMN "complexity"."entity_kind" IS 'the kind of the entity this score belongs to';
COMMENT ON COLUMN "complexity"."score" IS 'the value of the complexity, the value should fall between 0 and 1 indicating proximity to a baseline (up to 3 decimal places)';
COMMENT ON COLUMN "complexity"."last_updated_at" IS 'the datetime this complexity record was last updated';
COMMENT ON COLUMN "complexity"."last_updated_by" IS 'the last user to update this complexity record';
COMMENT ON COLUMN "complexity"."provenance" IS 'origination of this change unit record';

-- changeset dobra:1703194766143-98
CREATE TABLE "custom_environment" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "owning_entity_id" BIGINT NOT NULL, "owning_entity_kind" VARCHAR(64) NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "external_id" VARCHAR(200) NOT NULL, "group_name" VARCHAR(255) DEFAULT 'Default' NOT NULL, CONSTRAINT "custom_environment_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-99
CREATE TABLE "custom_environment_usage" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "custom_environment_id" BIGINT NOT NULL, "entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "created_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, CONSTRAINT "custom_env_usage_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-100
CREATE TABLE "database_usage" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "database_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "entity_id" BIGINT NOT NULL, "environment" VARCHAR(64) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "database_usage_id_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-101
CREATE TABLE "database_information" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "database_name" VARCHAR(255) DEFAULT 'waltz' NOT NULL, "instance_name" VARCHAR(255) DEFAULT 'waltz' NOT NULL, "dbms_vendor" VARCHAR(255) NOT NULL, "dbms_name" VARCHAR(255) NOT NULL, "dbms_version" VARCHAR(128) NOT NULL, "external_id" VARCHAR(200) DEFAULT 'waltz', "end_of_life_date" date, "lifecycle_status" VARCHAR(64), "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, CONSTRAINT "database_information_2_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-102
CREATE TABLE "flow_diagram_overlay_group" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "flow_diagram_id" BIGINT NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "external_id" VARCHAR(200) NOT NULL, "is_default" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "overlay_group_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-103
CREATE TABLE "flow_classification_rule" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "parent_kind" VARCHAR(64) NOT NULL, "parent_id" BIGINT NOT NULL, "subject_entity_id" BIGINT NOT NULL, "data_type_id" BIGINT NOT NULL, "flow_classification_id" BIGINT NOT NULL, "description" VARCHAR(4000), "external_id" VARCHAR(200), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) DEFAULT 'admin' NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, "subject_entity_kind" VARCHAR(64) DEFAULT 'APPLICATION' NOT NULL, CONSTRAINT "flow_classification_rule_id_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "flow_classification_rule" IS 'An instance of a flow classification rule.  Used to evaluate data flows against a list of authorised sources etc';
COMMENT ON COLUMN "flow_classification_rule"."parent_kind" IS 'the parent ref determines the scope of the rule. this is the entity kind part of the ref. Typically ORG_UNIT or APPLICATION';
COMMENT ON COLUMN "flow_classification_rule"."parent_id" IS 'the parent ref determines the scope of the rule. this is the entity id part of the ref';
COMMENT ON COLUMN "flow_classification_rule"."subject_entity_id" IS 'the subject entity id determines the which instance of an ACTOR or APPLICATION has the rule declared against it';
COMMENT ON COLUMN "flow_classification_rule"."data_type_id" IS 'reference to an entry in the data_type table.  The rule is hierarchy aware and will apply to child datatypes, unless overridden';
COMMENT ON COLUMN "flow_classification_rule"."flow_classification_id" IS 'reference to an entry in the flow_classification table.  This determines the result of the rule evaluation.  Typically points at things like ''Authoritative Source'' or ''Tactical Source''';
COMMENT ON COLUMN "flow_classification_rule"."is_readonly" IS 'determines if a user can update this rule. Useful when consuming rules from external sources';
COMMENT ON COLUMN "flow_classification_rule"."subject_entity_kind" IS 'the subject entity ref determines the kind of entity that has the rule declared against it. Typically APPLICATION or ACTOR';

-- changeset dobra:1703194766143-104
CREATE TABLE "flow_classification" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "code" VARCHAR(200) NOT NULL, "color" VARCHAR(255) NOT NULL, "position" INTEGER DEFAULT 0 NOT NULL, "is_custom" BOOLEAN DEFAULT TRUE NOT NULL, "user_selectable" BOOLEAN DEFAULT TRUE NOT NULL, CONSTRAINT "flow_classification_id_pkey" PRIMARY KEY ("id"));
COMMENT ON COLUMN "flow_classification"."name" IS 'display name for the flow classification. Examples include: Authorised Source, Tactical Source';
COMMENT ON COLUMN "flow_classification"."code" IS 'external identifier to isolate programmatic consumers from name changes';
COMMENT ON COLUMN "flow_classification"."color" IS 'if a flow is deemed to match this rule, this will be the resultant color.  Shown in a legend below the flow visualizations';
COMMENT ON COLUMN "flow_classification"."position" IS 'overrides the default (alphabetic) position, lower is earlier';
COMMENT ON COLUMN "flow_classification"."is_custom" IS 'Waltz provides some ''out of the box'' classification.  These should not be removed, but can have their names and colours updated';
COMMENT ON COLUMN "flow_classification"."user_selectable" IS 'Controls whether users can create rules which reference this classification.  Typically used to partition externally source rules from Waltz declared rules';

-- changeset dobra:1703194766143-105
CREATE TABLE "process_diagram" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000) NOT NULL, "diagram_kind" VARCHAR(64) DEFAULT 'WALTZ_PROCESS_JSON' NOT NULL, "layout_data" TEXT NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "created_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "created_by" VARCHAR(255) NOT NULL, "external_id" VARCHAR(200), "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "process_diagram_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "process_diagram" IS 'The process diagram table represents the metadata and layout data associated with a process diagram';

-- changeset dobra:1703194766143-106
CREATE TABLE "process_diagram_entity" ("diagram_id" BIGINT NOT NULL, "entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "is_notable" BOOLEAN DEFAULT FALSE, CONSTRAINT "process_diagram_entity_pkey" PRIMARY KEY ("diagram_id", "entity_id", "entity_kind"));
COMMENT ON TABLE "process_diagram_entity" IS 'A Bill of Materials (BoM) for a process diagram';

-- changeset dobra:1703194766143-107
CREATE TABLE "report_grid_member" ("grid_id" BIGINT NOT NULL, "user_id" VARCHAR(255) NOT NULL, "role" VARCHAR(64) DEFAULT 'VIEWER' NOT NULL, CONSTRAINT "report_grid_member_pkey" PRIMARY KEY ("grid_id", "user_id"));

-- changeset dobra:1703194766143-108
CREATE TABLE "aggregate_overlay_diagram" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "layout_data" TEXT NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "aggregated_entity_kind" VARCHAR(64) NOT NULL, "diagram_kind" VARCHAR(64) DEFAULT 'WALTZ_STATIC_SVG_OVERLAY' NOT NULL, "status" VARCHAR(64) DEFAULT 'DRAFT' NOT NULL, CONSTRAINT "aggregate_overlay_diagram_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "aggregate_overlay_diagram" IS 'svg diagram used to overlay waltz information, uses a data-cell-id attribute on the svg element to link to the cell_ext_id on aggregate_overlay_diagram_cell_data';
COMMENT ON COLUMN "aggregate_overlay_diagram"."id" IS 'unique identifier for this aggregate overlay diagram record within waltz';
COMMENT ON COLUMN "aggregate_overlay_diagram"."name" IS 'the name of this aggregate overlay diagram';
COMMENT ON COLUMN "aggregate_overlay_diagram"."description" IS 'longer description to provide more information about this aggregate overlay diagram';
COMMENT ON COLUMN "aggregate_overlay_diagram"."layout_data" IS 'the svg diagram used to overlay waltz data onto, uses a data-cell-id attribute to lookup data';
COMMENT ON COLUMN "aggregate_overlay_diagram"."last_updated_at" IS 'the datetime this aggregate overlay diagram record was last updated';
COMMENT ON COLUMN "aggregate_overlay_diagram"."last_updated_by" IS 'the last user to update this aggregate overlay diagram record';
COMMENT ON COLUMN "aggregate_overlay_diagram"."provenance" IS 'origination of this aggregate overlay diagram';
COMMENT ON COLUMN "aggregate_overlay_diagram"."aggregated_entity_kind" IS 'the kind of entity this diagram is aggregating';

-- changeset dobra:1703194766143-109
CREATE TABLE "aggregate_overlay_diagram_instance" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "diagram_id" BIGINT NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "parent_entity_kind" VARCHAR(64) NOT NULL, "parent_entity_id" BIGINT NOT NULL, "svg" TEXT NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "snapshot_data" TEXT, CONSTRAINT "aggregate_overlay_diagram_instance_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "aggregate_overlay_diagram_instance" IS 'an instance of an aggregate overlay diagram, specific to a particular vantage point in waltz e.g. an particular ORG_UNIT';
COMMENT ON COLUMN "aggregate_overlay_diagram_instance"."id" IS 'unique identifier for this aggregate overlay diagram instance record within waltz';
COMMENT ON COLUMN "aggregate_overlay_diagram_instance"."diagram_id" IS 'the reference to the aggregate overlay diagram that this instance references';
COMMENT ON COLUMN "aggregate_overlay_diagram_instance"."name" IS 'the name of this aggregate overlay diagram instance';
COMMENT ON COLUMN "aggregate_overlay_diagram_instance"."description" IS 'longer description to provide more information about this aggregate overlay diagram instance';
COMMENT ON COLUMN "aggregate_overlay_diagram_instance"."parent_entity_kind" IS 'the kind of entity which describes the in scope applications for this diagram';
COMMENT ON COLUMN "aggregate_overlay_diagram_instance"."parent_entity_id" IS 'the identifier for the entity which describes the in scope applications for this diagram';
COMMENT ON COLUMN "aggregate_overlay_diagram_instance"."last_updated_at" IS 'the datetime this aggregate overlay diagram record was last updated';
COMMENT ON COLUMN "aggregate_overlay_diagram_instance"."last_updated_by" IS 'the last user to update this aggregate overlay diagram instance record';
COMMENT ON COLUMN "aggregate_overlay_diagram_instance"."provenance" IS 'origination of this aggregate overlay diagram instance';
COMMENT ON COLUMN "aggregate_overlay_diagram_instance"."snapshot_data" IS 'json copy of the data backing this diagram instance.  Each row should be very flat and contain (at a minimum) a column ref so the client can present the appropriate tranche of data in the UI';

-- changeset dobra:1703194766143-110
CREATE TABLE "aggregate_overlay_diagram_cell_data" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "diagram_id" BIGINT NOT NULL, "cell_external_id" VARCHAR(200) NOT NULL, "related_entity_kind" VARCHAR(64) NOT NULL, "related_entity_id" BIGINT NOT NULL, CONSTRAINT "aggregate_overlay_diagram_cell_data_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "aggregate_overlay_diagram_cell_data" IS 'links entities in waltz to an svg diagram listed in the aggregate_overlay_diagram table';
COMMENT ON COLUMN "aggregate_overlay_diagram_cell_data"."id" IS 'unique identifier for this aggregate overlay diagram cell data record within waltz';
COMMENT ON COLUMN "aggregate_overlay_diagram_cell_data"."diagram_id" IS 'the reference to the aggregate overlay diagram that these entities relate to';
COMMENT ON COLUMN "aggregate_overlay_diagram_cell_data"."cell_external_id" IS 'used to assign the entity in waltz to an evg element on the related diagram, via the data-cell-id attribute';
COMMENT ON COLUMN "aggregate_overlay_diagram_cell_data"."related_entity_kind" IS 'the kind of entity being linked to the aggregate overlay diagram';
COMMENT ON COLUMN "aggregate_overlay_diagram_cell_data"."related_entity_id" IS 'the identifier for the entity being linked to the aggregate overlay diagram';

-- changeset dobra:1703194766143-111
CREATE TABLE "permission_group_involvement" ("permission_group_id" BIGINT NOT NULL, "involvement_group_id" BIGINT, "operation" VARCHAR(64) DEFAULT 'UNKNOWN' NOT NULL, "parent_kind" VARCHAR(64) NOT NULL, "subject_kind" VARCHAR(64), "qualifier_kind" VARCHAR(64), "qualifier_id" BIGINT);
COMMENT ON TABLE "permission_group_involvement" IS 'links a group of involvements to a given operation on an entity kind';
COMMENT ON COLUMN "permission_group_involvement"."permission_group_id" IS 'identifier of the permission group this association is tied to';
COMMENT ON COLUMN "permission_group_involvement"."involvement_group_id" IS 'identifier of the involvement group';
COMMENT ON COLUMN "permission_group_involvement"."operation" IS 'type of operation this involvement group is allowed to perform (one of: ADD, ATTEST, REMOVE, UPDATE, UNKNOWN)';
COMMENT ON COLUMN "permission_group_involvement"."parent_kind" IS 'kind of the parent entity the change is related to e.g. APPLICATION';
COMMENT ON COLUMN "permission_group_involvement"."subject_kind" IS 'kind of the entity the change acting upon e.g. MEASURABLE_RATING';
COMMENT ON COLUMN "permission_group_involvement"."qualifier_kind" IS 'kind of qualifier entity needed to specify a more specific permission e.g. MEASURABLE_CATEGORY';
COMMENT ON COLUMN "permission_group_involvement"."qualifier_id" IS 'identifier of the qualifier entity needed to specify a more specific permission';

-- changeset dobra:1703194766143-112
CREATE TABLE "aggregate_overlay_diagram_preset" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "diagram_id" BIGINT NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "external_id" VARCHAR(200) NOT NULL, "overlay_config" VARCHAR(4000) NOT NULL, "filter_config" VARCHAR(4000) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, CONSTRAINT "aggregate_overlay_diagram_preset_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-113
CREATE TABLE "report_grid_column_definition" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "report_grid_id" BIGINT NOT NULL, "position" INTEGER DEFAULT 0 NOT NULL, CONSTRAINT "report_grid_column_defn_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-114
CREATE TABLE "rating_scheme" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000) NOT NULL, "external_id" VARCHAR(200), CONSTRAINT "rating_scheme_definition_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "rating_scheme" IS 'Used to define a grouping of related values to be used when rating measurables and assessments';
COMMENT ON COLUMN "rating_scheme"."id" IS 'auto generated identifier';
COMMENT ON COLUMN "rating_scheme"."name" IS 'display name of the rating scheme';
COMMENT ON COLUMN "rating_scheme"."description" IS 'description of the rating scheme';
COMMENT ON COLUMN "rating_scheme"."external_id" IS 'external identifier for this rating scheme';

-- changeset dobra:1703194766143-115
CREATE TABLE "legal_entity" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "external_id" VARCHAR(200) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "entity_lifecycle_status" VARCHAR(64) DEFAULT 'ACTIVE' NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, CONSTRAINT "legal_entity_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "legal_entity" IS 'used to represent an individual, company, or organization that has legal rights and obligations';
COMMENT ON COLUMN "legal_entity"."id" IS 'autogenerated identifier';
COMMENT ON COLUMN "legal_entity"."name" IS 'display name for the legal entity';
COMMENT ON COLUMN "legal_entity"."description" IS 'longer description of the legal entity';
COMMENT ON COLUMN "legal_entity"."external_id" IS 'external identifier for this legal entity';
COMMENT ON COLUMN "legal_entity"."last_updated_at" IS 'when this legal entity record was last updated';
COMMENT ON COLUMN "legal_entity"."last_updated_by" IS 'user responsible for the last update to this legal entity record';
COMMENT ON COLUMN "legal_entity"."entity_lifecycle_status" IS 'the lifecycle state of this legal entity record (one of: ACTIVE, PENDING, REMOVED)';
COMMENT ON COLUMN "legal_entity"."provenance" IS 'where did this legal entity originate, will be ''waltz'' if provided via the UI';

-- changeset dobra:1703194766143-116
CREATE TABLE "legal_entity_relationship_kind" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), "target_kind" VARCHAR(64) NOT NULL, "cardinality" VARCHAR(64) DEFAULT 'ZERO_ONE' NOT NULL, "required_role" VARCHAR(64), "external_id" VARCHAR(200) NOT NULL, "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, CONSTRAINT "legal_entity_rel_kind_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "legal_entity_relationship_kind" IS 'describes the type of relationship between a legal entity and a target entity kind';
COMMENT ON COLUMN "legal_entity_relationship_kind"."id" IS 'autogenerated identifier';
COMMENT ON COLUMN "legal_entity_relationship_kind"."name" IS 'display name for the legal entity relationship kind';
COMMENT ON COLUMN "legal_entity_relationship_kind"."description" IS 'longer description of the legal entity relationship kind';
COMMENT ON COLUMN "legal_entity_relationship_kind"."target_kind" IS 'the kind of entity that a legal entity can have this kind of relationship with';
COMMENT ON COLUMN "legal_entity_relationship_kind"."cardinality" IS 'the number of relationships that can be supported between a legal entity and the target kind. Can be one of ''ZERO_ONE'' (default) or ''ZERO_MANY';
COMMENT ON COLUMN "legal_entity_relationship_kind"."required_role" IS 'the permitted role a user must have to make edits to relationships of this kind. If left blank no permitted role is required';
COMMENT ON COLUMN "legal_entity_relationship_kind"."external_id" IS 'external identifier for this legal entity relationship kind';
COMMENT ON COLUMN "legal_entity_relationship_kind"."last_updated_at" IS 'when this legal entity relationship kind record was last updated';
COMMENT ON COLUMN "legal_entity_relationship_kind"."last_updated_by" IS 'user responsible for the last update to this legal entity relationship kind record';
COMMENT ON COLUMN "legal_entity_relationship_kind"."provenance" IS 'where did this legal entity relationship kind originate, will be ''waltz'' if provided via the UI';

-- changeset dobra:1703194766143-117
CREATE TABLE "legal_entity_relationship" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "legal_entity_id" BIGINT NOT NULL, "relationship_kind_id" BIGINT NOT NULL, "target_kind" VARCHAR(64) NOT NULL, "target_id" BIGINT NOT NULL, "description" VARCHAR(4000), "external_id" VARCHAR(200), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "last_updated_by" VARCHAR(255) NOT NULL, "provenance" VARCHAR(64) DEFAULT 'waltz' NOT NULL, "is_readonly" BOOLEAN DEFAULT FALSE NOT NULL, CONSTRAINT "legal_entity_relationship_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "legal_entity_relationship" IS 'the relationship between a legal entity and target entity';
COMMENT ON COLUMN "legal_entity_relationship"."id" IS 'autogenerated identifier';
COMMENT ON COLUMN "legal_entity_relationship"."legal_entity_id" IS 'the identifier of the legal entity involved in the relationship';
COMMENT ON COLUMN "legal_entity_relationship"."relationship_kind_id" IS 'the type of relationship between the legal entity and the target';
COMMENT ON COLUMN "legal_entity_relationship"."target_kind" IS 'the kind of entity that a legal entity has been related to';
COMMENT ON COLUMN "legal_entity_relationship"."target_id" IS 'the if of the entity that a legal entity has been related to';
COMMENT ON COLUMN "legal_entity_relationship"."description" IS 'longer description of this legal entity relationship';
COMMENT ON COLUMN "legal_entity_relationship"."external_id" IS 'external identifier for this legal entity relationship';
COMMENT ON COLUMN "legal_entity_relationship"."last_updated_at" IS 'when this legal entity relationship kind record was last updated';
COMMENT ON COLUMN "legal_entity_relationship"."last_updated_by" IS 'user responsible for the last update to this legal entity relationship kind record';
COMMENT ON COLUMN "legal_entity_relationship"."provenance" IS 'where did this legal entity relationship originate, will be ''waltz'' if provided via the UI';
COMMENT ON COLUMN "legal_entity_relationship"."is_readonly" IS 'can this record be removed/edited by users (e.g. set to true if externally mastered)';

-- changeset dobra:1703194766143-118
CREATE TABLE "survey_instance_action_queue" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "action" VARCHAR(64) NOT NULL, "survey_instance_id" BIGINT NOT NULL, "action_params" VARCHAR(4000), "initial_state" VARCHAR(64) NOT NULL, "submitted_at" TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL, "submitted_by" VARCHAR(255) NOT NULL, "actioned_at" TIMESTAMP WITHOUT TIME ZONE, "status" VARCHAR(64) DEFAULT 'PENDING' NOT NULL, "message" VARCHAR(4000), "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "survey_instance_action_queue_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-119
CREATE TABLE "involvement_group" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "external_id" VARCHAR(200) NOT NULL, "provenance" VARCHAR(64) NOT NULL, CONSTRAINT "involvement_group_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "involvement_group" IS 'collection of involvement kinds';
COMMENT ON COLUMN "involvement_group"."id" IS 'unique identifier for this involvement group within waltz';
COMMENT ON COLUMN "involvement_group"."name" IS 'name of this involvement group';
COMMENT ON COLUMN "involvement_group"."external_id" IS 'external identifier for this involvement group';
COMMENT ON COLUMN "involvement_group"."provenance" IS 'origination of this involvement group';

-- changeset dobra:1703194766143-120
CREATE TABLE "key_involvement_kind" ("involvement_kind_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL);
COMMENT ON TABLE "key_involvement_kind" IS 'Key Involvement Kind For Entity Kind';

-- changeset dobra:1703194766143-121
CREATE TABLE "survey_instance_owner" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "survey_instance_id" BIGINT NOT NULL, "person_id" BIGINT NOT NULL, CONSTRAINT "survey_instance_owner_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-122
CREATE INDEX "idx_asset_code" ON "application"("asset_code");

-- changeset dobra:1703194766143-123
CREATE INDEX "idx_organisational_unit_id" ON "application"("organisational_unit_id");

-- changeset dobra:1703194766143-124
CREATE INDEX "idx_els_application" ON "application"("entity_lifecycle_status");

-- changeset dobra:1703194766143-125
CREATE INDEX "idx_bookmark_parent" ON "bookmark"("parent_id", "parent_kind");

-- changeset dobra:1703194766143-126
CREATE INDEX "idx_change_log_user_id" ON "change_log"("user_id");

-- changeset dobra:1703194766143-127
CREATE UNIQUE INDEX "idx_si_hostname" ON "server_information"("hostname");

-- changeset dobra:1703194766143-128
CREATE UNIQUE INDEX "idx_si_external_id" ON "server_information"("external_id");

-- changeset dobra:1703194766143-129
CREATE INDEX "idx_static_panel_group" ON "static_panel"("group");

-- changeset dobra:1703194766143-130
CREATE TABLE "role" ("key" VARCHAR(255) NOT NULL, "is_custom" BOOLEAN DEFAULT TRUE NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000) NOT NULL, "user_selectable" BOOLEAN DEFAULT TRUE NOT NULL, CONSTRAINT "role_pkey" PRIMARY KEY ("key"));

-- changeset dobra:1703194766143-131
ALTER TABLE "logical_flow" ADD CONSTRAINT "unique_logical_flow" UNIQUE ("source_entity_kind", "source_entity_id", "target_entity_kind", "target_entity_id");

-- changeset dobra:1703194766143-132
CREATE INDEX "idx_involvement_entity_emp" ON "involvement"("entity_kind", "entity_id", "employee_id");

-- changeset dobra:1703194766143-133
CREATE UNIQUE INDEX "idx_software_package_ext_id" ON "software_package"("external_id");

-- changeset dobra:1703194766143-134
CREATE UNIQUE INDEX "idx_sp_name_vendor" ON "software_package"("name", "group", "vendor");

-- changeset dobra:1703194766143-135
CREATE INDEX "idx_entity_relationship_a" ON "entity_relationship"("kind_a", "id_a");

-- changeset dobra:1703194766143-136
CREATE INDEX "idx_entity_relationship_b" ON "entity_relationship"("kind_b", "id_b");

-- changeset dobra:1703194766143-137
CREATE UNIQUE INDEX "idx_er_ida_ka_idb_kb_rel" ON "entity_relationship"("kind_a", "id_a", "kind_b", "id_b", "relationship");

-- changeset dobra:1703194766143-138
CREATE UNIQUE INDEX "idx_entity_statistic_definition_ext_id" ON "entity_statistic_definition"("external_id");

-- changeset dobra:1703194766143-139
CREATE INDEX "idx_esv_statistic_id" ON "entity_statistic_value"("statistic_id");

-- changeset dobra:1703194766143-140
CREATE INDEX "idx_esv_entity_ref_current" ON "entity_statistic_value"("entity_id", "current", "entity_kind");

-- changeset dobra:1703194766143-141
CREATE INDEX "idx_esv_statistic_id_outcome" ON "entity_statistic_value"("statistic_id", "outcome");

-- changeset dobra:1703194766143-142
CREATE INDEX "idx_entity_hier_kind_ancestor" ON "entity_hierarchy"("kind", "ancestor_id");

-- changeset dobra:1703194766143-143
CREATE UNIQUE INDEX "idx_code" ON "data_type"("code");

-- changeset dobra:1703194766143-144
CREATE INDEX "idx_lfd_lfid_deckind" ON "logical_flow_decorator"("logical_flow_id", "decorator_entity_kind");

-- changeset dobra:1703194766143-145
CREATE UNIQUE INDEX "idx_lfd_lfid_deckind_decid" ON "logical_flow_decorator"("logical_flow_id", "decorator_entity_kind", "decorator_entity_id");

-- changeset dobra:1703194766143-146
CREATE INDEX "idx_article_id" ON "physical_flow"("specification_id");

-- changeset dobra:1703194766143-147
CREATE INDEX "idx_pf_ext_id_provenance" ON "physical_flow"("external_id", "provenance");

-- changeset dobra:1703194766143-148
CREATE INDEX "idx_owning_entity" ON "physical_specification"("owning_entity_id", "owning_entity_kind");

-- changeset dobra:1703194766143-149
ALTER TABLE "actor" ADD CONSTRAINT "involvement_kind_name_key" UNIQUE ("name");

-- changeset dobra:1703194766143-150
ALTER TABLE "actor" ADD CONSTRAINT "unique_actor_ext_id" UNIQUE ("external_id");

-- changeset dobra:1703194766143-151
CREATE UNIQUE INDEX "idx_inv_kind_ext_id_uniq" ON "involvement_kind"("external_id");

-- changeset dobra:1703194766143-152
ALTER TABLE "involvement_kind" ADD CONSTRAINT "idx_inv_kind_name_subject_kind_unique" UNIQUE ("name", "subject_kind");

-- changeset dobra:1703194766143-153
CREATE INDEX "idx_measurable_category" ON "measurable"("measurable_category_id");

-- changeset dobra:1703194766143-154
CREATE UNIQUE INDEX "idx_category_ext_id_not_null" ON "measurable"("measurable_category_id", "external_id");

-- changeset dobra:1703194766143-155
CREATE INDEX "idx_m_rating_entity" ON "measurable_rating"("entity_id", "entity_kind");

-- changeset dobra:1703194766143-156
CREATE INDEX "idx_m_rating_measurable" ON "measurable_rating"("measurable_id");

-- changeset dobra:1703194766143-157
CREATE UNIQUE INDEX "idx_mr_entity_ref_m_id" ON "measurable_rating"("entity_id", "entity_kind", "measurable_id");

-- changeset dobra:1703194766143-158
ALTER TABLE "survey_template" ADD CONSTRAINT "survey_template_unique_name" UNIQUE ("name");

-- changeset dobra:1703194766143-159
CREATE INDEX "idx_survey_run_template" ON "survey_run"("survey_template_id");

-- changeset dobra:1703194766143-160
CREATE INDEX "idx_survey_instance_run" ON "survey_instance"("survey_run_id");

-- changeset dobra:1703194766143-161
CREATE INDEX "idx_survey_instance_entity" ON "survey_instance"("entity_id", "entity_kind");

-- changeset dobra:1703194766143-162
CREATE INDEX "idx_survey_recipient_instance" ON "survey_instance_recipient"("survey_instance_id");

-- changeset dobra:1703194766143-163
CREATE INDEX "idx_sir_person" ON "survey_instance_recipient"("person_id");

-- changeset dobra:1703194766143-164
CREATE INDEX "idx_survey_question_template" ON "survey_question"("survey_template_id");

-- changeset dobra:1703194766143-165
CREATE UNIQUE INDEX "idx_survey_q_tmpl_id_ext_id" ON "survey_question"("survey_template_id", "external_id");

-- changeset dobra:1703194766143-166
CREATE INDEX "idx_psd_specification_id" ON "physical_spec_defn"("specification_id");

-- changeset dobra:1703194766143-167
ALTER TABLE "physical_spec_defn" ADD CONSTRAINT "phy_spec_defn_unique_version" UNIQUE ("specification_id", "version");

-- changeset dobra:1703194766143-168
CREATE INDEX "idx_psdf_spec_defn_id" ON "physical_spec_defn_field"("spec_defn_id");

-- changeset dobra:1703194766143-169
CREATE INDEX "idx_psdsf_spec_defn_id" ON "physical_spec_defn_sample_file"("spec_defn_id");

-- changeset dobra:1703194766143-170
CREATE INDEX "idx_fda_diagram_id" ON "flow_diagram_annotation"("diagram_id");

-- changeset dobra:1703194766143-171
CREATE UNIQUE INDEX "idx_entity_named_note_type_ext_id" ON "entity_named_note_type"("external_id");

-- changeset dobra:1703194766143-172
CREATE INDEX "idx_air_user_id" ON "attestation_instance_recipient"("user_id");

-- changeset dobra:1703194766143-173
CREATE UNIQUE INDEX "idx_rating_scheme_item_ext_id" ON "rating_scheme_item"("scheme_id", "external_id");

-- changeset dobra:1703194766143-174
CREATE UNIQUE INDEX "idx_rating_scheme_item_unique" ON "rating_scheme_item"("scheme_id", "code");

-- changeset dobra:1703194766143-175
ALTER TABLE "rating_scheme_item" ADD CONSTRAINT "idx_rating_scheme_item_name_unique" UNIQUE ("scheme_id", "name");

-- changeset dobra:1703194766143-176
CREATE UNIQUE INDEX "idx_assessment_definition_ext_id" ON "assessment_definition"("external_id");

-- changeset dobra:1703194766143-177
ALTER TABLE "assessment_definition" ADD CONSTRAINT "idx_assessment_definition_name_unique" UNIQUE ("name");

-- changeset dobra:1703194766143-178
CREATE INDEX "idx_assessment_rating_entity" ON "assessment_rating"("entity_id", "entity_kind");

-- changeset dobra:1703194766143-179
ALTER TABLE "assessment_rating" ADD CONSTRAINT "assessment_rating_entity_kind_entity_id_assessment_definiti_key" UNIQUE ("entity_kind", "entity_id", "assessment_definition_id", "rating_id");

-- changeset dobra:1703194766143-180
CREATE INDEX "idx_svg_diagram_group" ON "svg_diagram"("group");

-- changeset dobra:1703194766143-181
CREATE INDEX "idx_scenario_roadmap_id" ON "scenario"("roadmap_id");

-- changeset dobra:1703194766143-182
CREATE INDEX "idx_scenario_rating_scenario_id" ON "scenario_rating_item"("scenario_id");

-- changeset dobra:1703194766143-183
CREATE INDEX "idx_scenario_rating_domain" ON "scenario_rating_item"("domain_item_kind", "domain_item_id");

-- changeset dobra:1703194766143-184
CREATE INDEX "idx_scenario_axis_scenario_id" ON "scenario_axis_item"("scenario_id");

-- changeset dobra:1703194766143-185
CREATE UNIQUE INDEX "idx_scenario_axis_uniq" ON "scenario_axis_item"("scenario_id", "orientation", "domain_item_kind", "domain_item_id");

-- changeset dobra:1703194766143-186
CREATE INDEX "idx_person_email" ON "person"("email");

-- changeset dobra:1703194766143-187
ALTER TABLE "person" ADD CONSTRAINT "unique_employee_id" UNIQUE ("employee_id");

-- changeset dobra:1703194766143-188
CREATE INDEX "idx_taxonomy_change_domain" ON "taxonomy_change"("domain_kind", "domain_id");

-- changeset dobra:1703194766143-189
CREATE INDEX "idx_taxonomy_change_pref" ON "taxonomy_change"("primary_reference_kind", "primary_reference_id");

-- changeset dobra:1703194766143-190
CREATE UNIQUE INDEX "idx_su_s_id_id_kind_env" ON "server_usage"("server_id", "entity_id", "entity_kind", "environment");

-- changeset dobra:1703194766143-191
ALTER TABLE "allocation" ADD CONSTRAINT "idx_alloc_scheme_mr_id_unique" UNIQUE ("allocation_scheme_id", "measurable_rating_id");

-- changeset dobra:1703194766143-192
CREATE INDEX "idx_change_set_parent_ref" ON "change_set"("parent_entity_id", "parent_entity_kind");

-- changeset dobra:1703194766143-193
CREATE INDEX "idx_change_unit_subject_ref" ON "change_unit"("subject_entity_id", "subject_entity_kind");

-- changeset dobra:1703194766143-194
CREATE INDEX "idx_change_unit_change_set" ON "change_unit"("change_set_id");

-- changeset dobra:1703194766143-195
CREATE INDEX "idx_attribute_change_change_unit" ON "attribute_change"("change_unit_id");

-- changeset dobra:1703194766143-196
CREATE UNIQUE INDEX "idx_licence_external_id" ON "licence"("external_id");

-- changeset dobra:1703194766143-197
CREATE INDEX "idx_external_identifier_ext_id" ON "external_identifier"("system", "external_id");

-- changeset dobra:1703194766143-198
CREATE INDEX "idx_external_identifier_ent_id" ON "external_identifier"("entity_kind", "entity_id");

-- changeset dobra:1703194766143-199
CREATE UNIQUE INDEX "idx_tag_target_kind" ON "tag"("name", "target_kind");

-- changeset dobra:1703194766143-200
CREATE UNIQUE INDEX "idx_alloc_scheme_name_cat" ON "allocation_scheme"("name", "measurable_category_id");

-- changeset dobra:1703194766143-201
CREATE UNIQUE INDEX "idx_software_version_ext_id" ON "software_version"("external_id");

-- changeset dobra:1703194766143-202
CREATE UNIQUE INDEX "idx_su_version_spid" ON "software_version"("version", "software_package_id");

-- changeset dobra:1703194766143-203
CREATE UNIQUE INDEX "idx_su_app_version" ON "software_usage"("application_id", "software_version_id");

-- changeset dobra:1703194766143-204
CREATE UNIQUE INDEX "idx_svl_version_licence" ON "software_version_licence"("software_version_id", "licence_id");

-- changeset dobra:1703194766143-205
CREATE INDEX "idx_attestation_instance_parent_entity_id" ON "attestation_instance"("parent_entity_id");

-- changeset dobra:1703194766143-206
ALTER TABLE "measurable_rating_planned_decommission" ADD CONSTRAINT "idx_mrpd_mr_id_unique" UNIQUE ("measurable_rating_id");

-- changeset dobra:1703194766143-207
ALTER TABLE "relationship_kind" ADD CONSTRAINT "unique_rel_kind" UNIQUE ("kind_a", "kind_b", "code");

-- changeset dobra:1703194766143-208
ALTER TABLE "vulnerability" ADD CONSTRAINT "idx_vulnerability_external_id" UNIQUE ("external_id");

-- changeset dobra:1703194766143-209
CREATE UNIQUE INDEX "idx_svv_version_vulnerability" ON "software_version_vulnerability"("software_version_id", "vulnerability_id");

-- changeset dobra:1703194766143-210
ALTER TABLE "report_grid" ADD CONSTRAINT "idx_report_grid_external_id" UNIQUE ("external_id");

-- changeset dobra:1703194766143-211
ALTER TABLE "permission_group" ADD CONSTRAINT "idx_permission_group_external_id" UNIQUE ("external_id");

-- changeset dobra:1703194766143-212
CREATE INDEX "idx_cost_cost_kind" ON "cost"("cost_kind_id");

-- changeset dobra:1703194766143-213
CREATE UNIQUE INDEX "idx_owning_entity_name" ON "custom_environment"("name", "owning_entity_kind", "owning_entity_id");

-- changeset dobra:1703194766143-214
CREATE UNIQUE INDEX "idx_env_id_entity" ON "custom_environment_usage"("custom_environment_id", "entity_kind", "entity_id");

-- changeset dobra:1703194766143-215
CREATE UNIQUE INDEX "idx_fcr_scope_dt_app" ON "flow_classification_rule"("parent_kind", "parent_id", "subject_entity_id", "data_type_id");

-- changeset dobra:1703194766143-216
CREATE UNIQUE INDEX "idx_agg_overlay_diagram_cell_data" ON "aggregate_overlay_diagram_cell_data"("diagram_id", "cell_external_id", "related_entity_kind", "related_entity_id");

-- changeset dobra:1703194766143-217
CREATE UNIQUE INDEX "idx_rating_scheme_ext_id" ON "rating_scheme"("external_id");

-- changeset dobra:1703194766143-218
ALTER TABLE "rating_scheme" ADD CONSTRAINT "idx_rating_scheme_name_unique" UNIQUE ("name");

-- changeset dobra:1703194766143-219
CREATE UNIQUE INDEX "idx_legal_entity_external_id" ON "legal_entity"("external_id");

-- changeset dobra:1703194766143-220
CREATE UNIQUE INDEX "idx_ler_kind_id_target" ON "legal_entity_relationship"("legal_entity_id", "target_id", "target_kind", "relationship_kind_id");

-- changeset dobra:1703194766143-221
ALTER TABLE "involvement_group" ADD CONSTRAINT "idx_involvement_group_external_id" UNIQUE ("external_id");

-- changeset dobra:1703194766143-222
ALTER TABLE "key_involvement_kind" ADD CONSTRAINT "unique_inv_kind_entity_kind" UNIQUE ("involvement_kind_id", "entity_kind");

-- changeset dobra:1703194766143-223
ALTER TABLE "survey_instance_owner" ADD CONSTRAINT "unique_survey_instance_owner_id" UNIQUE ("survey_instance_id", "person_id");

-- changeset dobra:1703194766143-224
CREATE TABLE "aggregate_overlay_diagram_callout" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "diagram_instance_id" BIGINT NOT NULL, "title" VARCHAR(255) NOT NULL, "content" VARCHAR(4000), "start_color" VARCHAR(64) NOT NULL, "end_color" VARCHAR(64) NOT NULL, "cell_external_id" VARCHAR(200) NOT NULL, CONSTRAINT "aggregate_overlay_diagram_callout_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-225
CREATE TABLE "allocated_cost_definition" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "allocation_scheme_id" BIGINT NOT NULL, "source_cost_kind_id" BIGINT NOT NULL, "target_cost_kind_id" BIGINT NOT NULL, CONSTRAINT "allocated_cost_definition_pkey" PRIMARY KEY ("id"));
COMMENT ON COLUMN "allocated_cost_definition"."allocation_scheme_id" IS 'reference to the allocation scheme that will be used to split cost from the source kind onto new costs represented by the target kind';
COMMENT ON COLUMN "allocated_cost_definition"."source_cost_kind_id" IS 'reference to the cost kind being used as the source costs, usually a cost related to applications';
COMMENT ON COLUMN "allocated_cost_definition"."target_cost_kind_id" IS 'reference to the cost kind being to represent the shredded target costs, usually a cost related to measurable_ratings';

-- changeset dobra:1703194766143-226
CREATE TABLE "application_component" ("id" BIGINT NOT NULL, "application_id" BIGINT, CONSTRAINT "pk_application_component" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-227
CREATE TABLE "application_relationship" ("id" BIGINT NOT NULL, "relation_kind" BIGINT, CONSTRAINT "pk_application_relationship" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-228
CREATE TABLE "entity_field_reference" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "field_name" VARCHAR(64) NOT NULL, "display_name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000) NOT NULL, CONSTRAINT "entity_field_reference_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-229
CREATE TABLE "entity_svg_diagram" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "entity_id" BIGINT NOT NULL, "name" VARCHAR(255) NOT NULL, "svg" TEXT NOT NULL, "description" VARCHAR(4000), "provenance" VARCHAR(64) NOT NULL, "external_id" VARCHAR(200), CONSTRAINT "entity_svg_diagram_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "entity_svg_diagram" IS 'SVG diagrams associated to a specific entity';

-- changeset dobra:1703194766143-230
CREATE TABLE "entity_workflow_definition" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "name" VARCHAR(255) NOT NULL, "description" VARCHAR(4000), CONSTRAINT "entity_workflow_defn_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "entity_workflow_definition" IS 'Store entity workflow definitions';

-- changeset dobra:1703194766143-231
CREATE TABLE "enum_value_alias" ("enum_type" VARCHAR(64) NOT NULL, "enum_key" VARCHAR(64) NOT NULL, "alias" VARCHAR(255) NOT NULL);

-- changeset dobra:1703194766143-232
CREATE TABLE "flow_diagram_overlay_group_entry" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "overlay_group_id" BIGINT NOT NULL, "entity_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL, "symbol" VARCHAR(64) NOT NULL, "fill" VARCHAR(64) NOT NULL, "stroke" VARCHAR(64) NOT NULL, CONSTRAINT "overlay_group_entry_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-233
CREATE TABLE "involvement_group_entry" ("involvement_group_id" BIGINT NOT NULL, "involvement_kind_id" BIGINT NOT NULL);
COMMENT ON TABLE "involvement_group_entry" IS 'describes the association of an involvement kind to an involvement group';
COMMENT ON COLUMN "involvement_group_entry"."involvement_group_id" IS 'identifier of the group this involvement kind is included in';
COMMENT ON COLUMN "involvement_group_entry"."involvement_kind_id" IS 'identifier of the involvement kind this entry refers to';

-- changeset dobra:1703194766143-234
CREATE TABLE "permission_group_entry" ("entity_id" BIGINT NOT NULL, "permission_group_id" BIGINT NOT NULL, "entity_kind" VARCHAR(64) NOT NULL);
COMMENT ON TABLE "permission_group_entry" IS 'entities which have specific permissions which replace the default permission group';
COMMENT ON COLUMN "permission_group_entry"."entity_id" IS 'the id of the entity being given specific permissions';
COMMENT ON COLUMN "permission_group_entry"."permission_group_id" IS 'identifier of the permission group being linked to';
COMMENT ON COLUMN "permission_group_entry"."entity_kind" IS 'the type of the entity being given specific permissions';

-- changeset dobra:1703194766143-235
CREATE TABLE "report_grid_derived_column_definition" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "display_name" VARCHAR(255) NOT NULL, "column_description" VARCHAR(4000), "derivation_script" VARCHAR NOT NULL, "external_id" VARCHAR(200), "grid_column_id" BIGINT NOT NULL, CONSTRAINT "report_grid_derived_column_defn_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-236
CREATE TABLE "survey_question_dropdown_entry" ("id" BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, "question_id" BIGINT NOT NULL, "value" VARCHAR(4000) NOT NULL, "position" INTEGER NOT NULL, CONSTRAINT "sq_dropdown_entry_pkey" PRIMARY KEY ("id"));
COMMENT ON TABLE "survey_question_dropdown_entry" IS 'Stores allowed dropdown values for a survey question';

-- changeset dobra:1703194766143-237
CREATE TABLE "survey_question_response" ("survey_instance_id" BIGINT NOT NULL, "question_id" BIGINT NOT NULL, "person_id" BIGINT NOT NULL, "comment" VARCHAR(4000), "last_updated_at" TIMESTAMP WITHOUT TIME ZONE NOT NULL, "string_response" VARCHAR(4000), "number_response" numeric(19, 4), "boolean_response" BOOLEAN, "entity_response_id" BIGINT, "entity_response_kind" VARCHAR(64), "date_response" date, "list_response_concat" VARCHAR, CONSTRAINT "survey_question_response_pkey" PRIMARY KEY ("survey_instance_id", "question_id"));

-- changeset dobra:1703194766143-238
CREATE TABLE "system_job_log" ("name" VARCHAR(128) NOT NULL, "entity_kind" VARCHAR(128) NOT NULL, "status" VARCHAR(64) NOT NULL, "description" VARCHAR(2048), "start" TIMESTAMP WITHOUT TIME ZONE NOT NULL, "end" TIMESTAMP WITHOUT TIME ZONE, CONSTRAINT "system_job_log_pkey" PRIMARY KEY ("name", "entity_kind", "start"));

-- changeset dobra:1703194766143-239
CREATE TABLE "user" ("user_name" VARCHAR(255) NOT NULL, "password" VARCHAR(255) NOT NULL, CONSTRAINT "user_pkey" PRIMARY KEY ("user_name"));

-- changeset dobra:1703194766143-240
CREATE TABLE "user_agent_info" ("id" INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, "user_name" VARCHAR(128) NOT NULL, "user_agent" VARCHAR(500) NOT NULL, "resolution" VARCHAR(128) NOT NULL, "operating_system" VARCHAR(128) NOT NULL, "ip_address" VARCHAR(128) NOT NULL, "login_timestamp" TIMESTAMP WITHOUT TIME ZONE NOT NULL, CONSTRAINT "user_agent_info_pkey" PRIMARY KEY ("id"));

-- changeset dobra:1703194766143-241
CREATE TABLE "user_preference" ("key" VARCHAR(120) NOT NULL, "value" VARCHAR(2048) NOT NULL, "user_name" VARCHAR(255) NOT NULL);

-- changeset dobra:1703194766143-242
CREATE TABLE "user_role" ("user_name" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL);

-- changeset dobra:1703194766143-243
ALTER TABLE "data_type_usage" ADD CONSTRAINT "data_type_usage_pkey" PRIMARY KEY ("entity_kind", "entity_id", "data_type_id", "usage_kind");

-- changeset dobra:1703194766143-244
ALTER TABLE "entity_alias" ADD CONSTRAINT "entity_alias_pkey" PRIMARY KEY ("id", "kind", "alias");

-- changeset dobra:1703194766143-245
ALTER TABLE "external_identifier" ADD CONSTRAINT "external_identifier_pkey" PRIMARY KEY ("entity_id", "entity_kind", "system", "external_id");

-- changeset dobra:1703194766143-246
ALTER TABLE "flow_diagram_annotation" ADD CONSTRAINT "flow_diagram_annotation_pkey" PRIMARY KEY ("diagram_id", "annotation_id");

-- changeset dobra:1703194766143-247
ALTER TABLE "physical_flow_participant" ADD CONSTRAINT "physical_flow_participant_pkey" PRIMARY KEY ("physical_flow_id", "participant_entity_id", "participant_entity_kind", "kind");

-- changeset dobra:1703194766143-248
ALTER TABLE "thumbnail" ADD CONSTRAINT "thumbnail_pkey" PRIMARY KEY ("parent_entity_id", "parent_entity_kind");

-- changeset dobra:1703194766143-249
ALTER TABLE "user_preference" ADD CONSTRAINT "user_preference_pkey" PRIMARY KEY ("user_name", "key");

-- changeset dobra:1703194766143-250
ALTER TABLE "aggregate_overlay_diagram_callout" ADD CONSTRAINT "agg_overlay_diag_callout_fk" FOREIGN KEY ("diagram_instance_id") REFERENCES "aggregate_overlay_diagram_instance" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-251
ALTER TABLE "aggregate_overlay_diagram_cell_data" ADD CONSTRAINT "agg_overlay_diag_cell_data_fk" FOREIGN KEY ("diagram_id") REFERENCES "aggregate_overlay_diagram" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-252
ALTER TABLE "aggregate_overlay_diagram_instance" ADD CONSTRAINT "agg_overlay_diag_instance_fk" FOREIGN KEY ("diagram_id") REFERENCES "aggregate_overlay_diagram" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-253
ALTER TABLE "aggregate_overlay_diagram_preset" ADD CONSTRAINT "agg_overlay_diag_preset_diag_id_fkey" FOREIGN KEY ("diagram_id") REFERENCES "aggregate_overlay_diagram" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-254
ALTER TABLE "allocation_scheme" ADD CONSTRAINT "alloc_scheme_measurable_cat_fk" FOREIGN KEY ("measurable_category_id") REFERENCES "measurable_category" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-255
ALTER TABLE "allocated_cost_definition" ADD CONSTRAINT "allocated_cost_defn_allocation_scheme_fk" FOREIGN KEY ("allocation_scheme_id") REFERENCES "allocation_scheme" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-256
ALTER TABLE "allocated_cost_definition" ADD CONSTRAINT "allocated_cost_defn_source_cost_kind_fk" FOREIGN KEY ("source_cost_kind_id") REFERENCES "cost_kind" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-257
ALTER TABLE "allocated_cost_definition" ADD CONSTRAINT "allocated_cost_defn_target_cost_kind_fk" FOREIGN KEY ("target_cost_kind_id") REFERENCES "cost_kind" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-258
ALTER TABLE "allocation" ADD CONSTRAINT "allocation_allocation_scheme_fk" FOREIGN KEY ("allocation_scheme_id") REFERENCES "allocation_scheme" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-259
ALTER TABLE "allocation" ADD CONSTRAINT "allocation_measurable_rating_fk" FOREIGN KEY ("measurable_rating_id") REFERENCES "measurable_rating" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-260
ALTER TABLE "application_group_ou_entry" ADD CONSTRAINT "app_grp_ou_entry_grp_id_fkey" FOREIGN KEY ("group_id") REFERENCES "application_group" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-261
ALTER TABLE "application_group_entry" ADD CONSTRAINT "application_group_entry_group_id_fkey" FOREIGN KEY ("group_id") REFERENCES "application_group" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-262
ALTER TABLE "application_group_member" ADD CONSTRAINT "application_group_member_group_id_fkey" FOREIGN KEY ("group_id") REFERENCES "application_group" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-263
ALTER TABLE "assessment_definition" ADD CONSTRAINT "assessment_defn_rating_schm_fk" FOREIGN KEY ("rating_scheme_id") REFERENCES "rating_scheme" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-264
ALTER TABLE "assessment_rating" ADD CONSTRAINT "assessment_rating_rating_scheme_item_fk" FOREIGN KEY ("rating_id") REFERENCES "rating_scheme_item" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-265
ALTER TABLE "assessment_rating" ADD CONSTRAINT "assessment_rating_to_definition_fk" FOREIGN KEY ("assessment_definition_id") REFERENCES "assessment_definition" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-266
ALTER TABLE "attestation_instance" ADD CONSTRAINT "attestation_instance_run_fk" FOREIGN KEY ("attestation_run_id") REFERENCES "attestation_run" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-267
ALTER TABLE "complexity" ADD CONSTRAINT "complexity_to_complexity_kind_id_fk" FOREIGN KEY ("complexity_kind_id") REFERENCES "complexity_kind" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-268
ALTER TABLE "cost" ADD CONSTRAINT "cost_to_cost_kind_id_fk" FOREIGN KEY ("cost_kind_id") REFERENCES "cost_kind" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-269
ALTER TABLE "custom_environment_usage" ADD CONSTRAINT "custom_env_usage_to_custom_env_fk" FOREIGN KEY ("custom_environment_id") REFERENCES "custom_environment" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-270
ALTER TABLE "database_usage" ADD CONSTRAINT "database_usage_database_id_fk" FOREIGN KEY ("database_id") REFERENCES "database_information" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-271
ALTER TABLE "report_grid_derived_column_definition" ADD CONSTRAINT "derived_column_grid_column_id_fk" FOREIGN KEY ("grid_column_id") REFERENCES "report_grid_column_definition" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-272
ALTER TABLE "entity_relationship" ADD CONSTRAINT "entity_rel_to_rel_kind_fkey" FOREIGN KEY ("kind_a", "kind_b", "relationship") REFERENCES "relationship_kind" ("kind_a", "kind_b", "code") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-273
ALTER TABLE "enum_value_alias" ADD CONSTRAINT "enum_value_alias_type_key_fkey" FOREIGN KEY ("enum_type", "enum_key") REFERENCES "enum_value" ("type", "key") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-274
ALTER TABLE "flow_diagram_overlay_group_entry" ADD CONSTRAINT "fd_overlay_group_entry_fd_overlay_group_id_fk" FOREIGN KEY ("overlay_group_id") REFERENCES "flow_diagram_overlay_group" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-275
ALTER TABLE "flow_diagram_overlay_group" ADD CONSTRAINT "fd_overlay_group_flow_diagram_id_fk" FOREIGN KEY ("flow_diagram_id") REFERENCES "flow_diagram" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-276
ALTER TABLE "report_grid_fixed_column_definition" ADD CONSTRAINT "fixed_column_grid_column_id_fk" FOREIGN KEY ("grid_column_id") REFERENCES "report_grid_column_definition" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-277
ALTER TABLE "application_component" ADD CONSTRAINT "fk_application_component_application" FOREIGN KEY ("application_id") REFERENCES "application" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-278
ALTER TABLE "application_group_entry" ADD CONSTRAINT "fk_application_group_entry_application" FOREIGN KEY ("application_id") REFERENCES "application" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-279
ALTER TABLE "application_group_ou_entry" ADD CONSTRAINT "fk_application_group_ou_entry_organisational_unit" FOREIGN KEY ("org_unit_id") REFERENCES "organisational_unit" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-280
ALTER TABLE "change_unit" ADD CONSTRAINT "fk_change_unit_change_set" FOREIGN KEY ("change_set_id") REFERENCES "change_set" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-281
ALTER TABLE "entity_enum_value" ADD CONSTRAINT "fk_entity_enum_value_entity_enum_definition" FOREIGN KEY ("definition_id") REFERENCES "entity_enum_definition" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-282
ALTER TABLE "user_agent_info" ADD CONSTRAINT "fk_user_agent_info_user" FOREIGN KEY ("user_name") REFERENCES "user" ("user_name") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-283
ALTER TABLE "user_preference" ADD CONSTRAINT "fk_user_preference_user" FOREIGN KEY ("user_name") REFERENCES "user" ("user_name") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-284
ALTER TABLE "flow_classification_rule" ADD CONSTRAINT "flow_classification_rule_classification_id_fkey" FOREIGN KEY ("flow_classification_id") REFERENCES "flow_classification" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-285
ALTER TABLE "flow_classification_rule" ADD CONSTRAINT "flow_classification_rule_data_type_id_fkey" FOREIGN KEY ("data_type_id") REFERENCES "data_type" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-286
ALTER TABLE "involvement" ADD CONSTRAINT "inv_kind_to_inv_fk" FOREIGN KEY ("kind_id") REFERENCES "involvement_kind" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-287
ALTER TABLE "involvement" ADD CONSTRAINT "inv_to_person_fk" FOREIGN KEY ("employee_id") REFERENCES "person" ("employee_id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-288
ALTER TABLE "involvement_group_entry" ADD CONSTRAINT "involvement_group_entry_group_fk" FOREIGN KEY ("involvement_group_id") REFERENCES "involvement_group" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-289
ALTER TABLE "involvement_group_entry" ADD CONSTRAINT "involvement_group_entry_inv_kind_fk" FOREIGN KEY ("involvement_kind_id") REFERENCES "involvement_kind" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-290
ALTER TABLE "key_involvement_kind" ADD CONSTRAINT "key_inv_kind_to_inv_kind_fk" FOREIGN KEY ("involvement_kind_id") REFERENCES "involvement_kind" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-291
ALTER TABLE "legal_entity_relationship" ADD CONSTRAINT "legal_entity_rel_legal_entity_id_fkey" FOREIGN KEY ("legal_entity_id") REFERENCES "legal_entity" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-292
ALTER TABLE "legal_entity_relationship" ADD CONSTRAINT "legal_entity_rel_rel_kind_id_fkey" FOREIGN KEY ("relationship_kind_id") REFERENCES "legal_entity_relationship_kind" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-293
ALTER TABLE "logical_flow_decorator" ADD CONSTRAINT "lfd_flow_classification_rule_id_fkey" FOREIGN KEY ("flow_classification_rule_id") REFERENCES "flow_classification_rule" ("id") ON UPDATE NO ACTION ON DELETE SET NULL;

-- changeset dobra:1703194766143-294
ALTER TABLE "measurable_category" ADD CONSTRAINT "measurable_category_assessment_def_fk" FOREIGN KEY ("constraining_assessment_definition_id") REFERENCES "assessment_definition" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-295
ALTER TABLE "measurable_category" ADD CONSTRAINT "measurable_category_rating_scheme_fk" FOREIGN KEY ("rating_scheme_id") REFERENCES "rating_scheme" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-296
ALTER TABLE "measurable" ADD CONSTRAINT "measurable_measurable_ctgry_fk" FOREIGN KEY ("measurable_category_id") REFERENCES "measurable_category" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-297
ALTER TABLE "measurable" ADD CONSTRAINT "measurable_measurable_parent_fk" FOREIGN KEY ("parent_id") REFERENCES "measurable" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-298
ALTER TABLE "measurable_rating_planned_decommission" ADD CONSTRAINT "measurable_rating_planned_decommission_fk" FOREIGN KEY ("measurable_rating_id") REFERENCES "measurable_rating" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-299
ALTER TABLE "measurable_rating_replacement" ADD CONSTRAINT "measurable_rating_replacement_application_fk" FOREIGN KEY ("entity_id") REFERENCES "application" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-300
ALTER TABLE "measurable_rating_replacement" ADD CONSTRAINT "measurable_rating_replacement_planned_decommission_fk" FOREIGN KEY ("decommission_id") REFERENCES "measurable_rating_planned_decommission" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-301
ALTER TABLE "permission_group_entry" ADD CONSTRAINT "permission_group_entry_application_id_fk" FOREIGN KEY ("entity_id") REFERENCES "application" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-302
ALTER TABLE "permission_group_entry" ADD CONSTRAINT "permission_group_id_fk" FOREIGN KEY ("permission_group_id") REFERENCES "permission_group" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-303
ALTER TABLE "permission_group_involvement" ADD CONSTRAINT "permission_involvement_group_id_fk" FOREIGN KEY ("involvement_group_id") REFERENCES "involvement_group" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-304
ALTER TABLE "rating_scheme_item" ADD CONSTRAINT "rating_scheme_item_rating_scheme_fk" FOREIGN KEY ("scheme_id") REFERENCES "rating_scheme" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-305
ALTER TABLE "report_grid_member" ADD CONSTRAINT "report_grid_to_grid_member_fk" FOREIGN KEY ("grid_id") REFERENCES "report_grid" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-306
ALTER TABLE "report_grid_column_definition" ADD CONSTRAINT "rgcd_report_grid_id_rg_id_fk" FOREIGN KEY ("report_grid_id") REFERENCES "report_grid" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-307
ALTER TABLE "roadmap" ADD CONSTRAINT "roadmap_rating_scheme_fk" FOREIGN KEY ("rating_scheme_id") REFERENCES "rating_scheme" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-308
ALTER TABLE "server_usage" ADD CONSTRAINT "server_usage_server_id_fk" FOREIGN KEY ("server_id") REFERENCES "server_information" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-309
ALTER TABLE "survey_instance_action_queue" ADD CONSTRAINT "si_action_queue_si_id_fk" FOREIGN KEY ("survey_instance_id") REFERENCES "survey_instance" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-310
ALTER TABLE "software_usage" ADD CONSTRAINT "soft_usage_version_fk" FOREIGN KEY ("software_version_id") REFERENCES "software_version" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-311
ALTER TABLE "software_version" ADD CONSTRAINT "soft_version_package_spid_fk" FOREIGN KEY ("software_package_id") REFERENCES "software_package" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-312
ALTER TABLE "survey_instance_owner" ADD CONSTRAINT "survey_instance_owner_instance_id_fkey" FOREIGN KEY ("survey_instance_id") REFERENCES "survey_instance" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-313
ALTER TABLE "survey_instance_owner" ADD CONSTRAINT "survey_instance_owner_person_id_fkey" FOREIGN KEY ("person_id") REFERENCES "person" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-314
ALTER TABLE "survey_question_list_response" ADD CONSTRAINT "survey_q_list_resp_survey_q_resp_fk" FOREIGN KEY ("survey_instance_id", "question_id") REFERENCES "survey_question_response" ("survey_instance_id", "question_id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-315
ALTER TABLE "survey_question_response" ADD CONSTRAINT "survey_q_resp_survey_inst_fk" FOREIGN KEY ("survey_instance_id") REFERENCES "survey_instance" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-316
ALTER TABLE "survey_question_response" ADD CONSTRAINT "survey_q_resp_survey_q_fk" FOREIGN KEY ("question_id") REFERENCES "survey_question" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-317
ALTER TABLE "survey_question" ADD CONSTRAINT "survey_question_template_fk" FOREIGN KEY ("survey_template_id") REFERENCES "survey_template" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

-- changeset dobra:1703194766143-318
ALTER TABLE "software_version_licence" ADD CONSTRAINT "svl_licence_fk" FOREIGN KEY ("licence_id") REFERENCES "licence" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-319
ALTER TABLE "software_version_licence" ADD CONSTRAINT "svl_version_fk" FOREIGN KEY ("software_version_id") REFERENCES "software_version" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-320
ALTER TABLE "tag_usage" ADD CONSTRAINT "tag_usage_tag_id_fk" FOREIGN KEY ("tag_id") REFERENCES "tag" ("id") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-321
ALTER TABLE "user_role" ADD CONSTRAINT "user_role_role_key_fk" FOREIGN KEY ("role") REFERENCES "role" ("key") ON UPDATE NO ACTION ON DELETE CASCADE;

-- changeset dobra:1703194766143-322
ALTER TABLE "user_role" ADD CONSTRAINT "user_role_user_name_fkey" FOREIGN KEY ("user_name") REFERENCES "user" ("user_name") ON UPDATE NO ACTION ON DELETE CASCADE;

